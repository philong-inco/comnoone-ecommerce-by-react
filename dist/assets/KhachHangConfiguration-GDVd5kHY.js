import{b as he,r as a,c as y,j as e,p as de,T as ue,G as n,B as H,f as p,n as v,F as me,R as ge,i as M,k as $,s as q,t as _,o as T,m as P}from"./index-DkjfH3Nj.js";import{u as pe,C as l,o as xe}from"./yup-BKebgrQI.js";import{c as fe,a as k,d as je,b as be}from"./index.esm-D6JTX8U2.js";import{d as ye}from"./ArrowBack-UBXgL3WF.js";import{L as ve,A as ke}from"./AdapterMoment-BrGwQ__3.js";import{M as x}from"./MenuItem-B1FZ8Sxq.js";import{C as Se}from"./CircularProgress-C_rxJWba.js";import{S as De,A as Ce}from"./Snackbar-BAUbN_1o.js";import{D as we,a as _e,b as Te,c as Pe}from"./DialogTitle-AfTjaLGA.js";import{D as Ee}from"./DialogContentText-C61vxrGH.js";import"./useThemeProps-C91a8WKB.js";import"./moment-G82_0lEo.js";import"./Close-DQEw0W5Z.js";const B=fe().shape({ten:k().max(50,"Tên không được vượt quá 50 ký tự").required("Tên không được để trống"),email:k().email("Email không hợp lệ").required("Email không được để trống"),sdt:k().matches(/^\+?[0-9. ()-]{7,25}$/,"Số điện thoại không hợp lệ").required("Số điện thoại không được để trống"),ngay_sinh:je().required("Ngày sinh không được để trống").max(new Date,"Ngày sinh phải là quá khứ hoặc hiện tại").test("age","Khách hàng phải từ 10 tuổi trở lên",f=>{if(!f)return!1;const h=new Date,d=new Date(f);let i=h.getFullYear()-d.getFullYear();const s=h.getMonth()-d.getMonth();return(s<0||s===0&&h.getDate()<d.getDate())&&i--,i>=10}),gioi_tinh:be().required("Giới tính không được để trống"),hinhAnh:k()});function Ge(){const f=he(),{register:h,handleSubmit:d,control:i,formState:{errors:s}}=pe({resolver:xe(B)}),[S,O]=a.useState(""),[R,G]=a.useState([]),[K,z]=a.useState([]),[U,X]=a.useState([]),[u,Q]=a.useState(""),[m,Y]=a.useState(""),[E,J]=a.useState(""),[V,j]=a.useState(""),[W,Z]=a.useState(null),[ee,b]=a.useState(!1),[te,D]=a.useState(""),[re,C]=a.useState("success");a.useState(!1),a.useEffect(()=>{(async()=>{try{j(!0),await se()}catch{Z("Failed to fetch initial data")}finally{j(!1)}})()},[]),a.useEffect(()=>{u&&ae(u)},[u]),a.useEffect(()=>{m&&ne(m)},[m]),a.useEffect(()=>{var t;const r=Object.keys(s);if(r.length>0){const o=r[0],g=((t=s[o])==null?void 0:t.message)||"Đã xảy ra lỗi";D(g),C("error"),b(!0)}},[s]);const se=async()=>{try{const r=await y.get("https://online-gateway.ghn.vn/shiip/public-api/master-data/province",{headers:{token:"0292ba75-34b6-11ef-89ca-1aad91406dac"}});G(r.data.data)}catch(r){throw console.error("Error fetching provinces:",r),r}},ae=async r=>{try{const t=await y.get("https://online-gateway.ghn.vn/shiip/public-api/master-data/district",{headers:{token:"0292ba75-34b6-11ef-89ca-1aad91406dac"},params:{province_id:r}});z(t.data.data)}catch(t){throw console.error("Error fetching districts:",t),t}},ne=async r=>{try{const t=await y.get("https://online-gateway.ghn.vn/shiip/public-api/master-data/ward",{headers:{token:"0292ba75-34b6-11ef-89ca-1aad91406dac"},params:{district_id:r}});X(t.data.data)}catch(t){throw console.error("Error fetching wards:",t),t}},F=()=>{window.cloudinary.openUploadWidget({cloudName:"daljc2ktr",uploadPreset:"ovuxjxsx",sources:["local","url","camera","google_photos","facebook","dropbox","instagram"],multiple:!1,cropping:!0,folder:"customers_images"},(r,t)=>{!r&&t.event==="success"&&O(t.info.secure_url)})},I=()=>{b(!1)},N=()=>{f("/khachhang/danhsachkhachhang")},[ie,A]=a.useState(!1),[c,oe]=a.useState(null),le=r=>{oe(r),A(!0)},w=async r=>{if(A(!1),r&&c){j(!0);try{let t={ten:c.ten,email:c.email,sdt:c.sdt,ngay_sinh:new Date(c.ngay_sinh).toISOString(),gioi_tinh:c.gioi_tinh,hinhAnh:S,idPhuongXa:E,idQuanHuyen:m,idTinhThanhPho:u,diaChiNhanHang:c.dia_chi};if(await B.validate(t),(await y.post("https://weblaptop-by-springboot-and-reactjs.onrender.com/api/khachhang/create",t,{headers:{"Content-Type":"application/json"}})).status===200)D("Dữ liệu khách hàng được thêm thành công!"),C("success"),b(!0),setTimeout(N,3e3);else throw new Error("Unexpected response status")}catch(t){ce(t)}finally{j(!1)}}},ce=r=>{debugger;let t="Có lỗi xảy ra khi xử lý yêu cầu!";if(r.response&&r.response.data){const o=r.response.data;if(o.message&&(t=o.message),o.error){const g=o.error.split(":").pop().trim();t=`${t}: ${g}`}if(o.errors&&Array.isArray(o.errors)){const g=o.errors.map(L=>L.message||L).join("; ");t=`${t}. Chi tiết: ${g}`}}else r.message&&(t=r.message);D(t),C("error"),b(!0)};return e.jsxs(ve,{dateAdapter:ke,children:[e.jsx(de,{color:"primary","aria-label":"back",sx:{position:"fixed",bottom:16,right:16},onClick:N,children:e.jsx(ye,{})}),e.jsx(ue,{variant:"h1",gutterBottom:!0,style:{textAlign:"center",marginBottom:"5%"},children:"Thêm Khách Hàng"}),e.jsx("form",{onSubmit:d(le),children:e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,md:4,children:e.jsx(H,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:S?e.jsx("img",{src:S,alt:"Ảnh đại diện",style:{width:"250px",height:"250px",objectFit:"cover",cursor:"pointer",borderRadius:"50%",boxShadow:"0px 4px 15px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease"},onClick:F}):e.jsx("img",{src:"https://res.cloudinary.com/daljc2ktr/image/upload/v1722592745/employee_images/zbphcixipri1c8rcdeov.jpg",alt:"Ảnh đại diện",style:{width:"250px",height:"250px",objectFit:"cover",cursor:"pointer",borderRadius:"50%",boxShadow:"0px 4px 15px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease"},onClick:F})})}),e.jsx(n,{item:!0,xs:12,md:8,children:e.jsxs(n,{container:!0,spacing:3,children:[e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(l,{name:"ten",control:i,render:({field:r})=>{var t;return e.jsx(p,{fullWidth:!0,label:"Họ và tên",variant:"outlined",InputLabelProps:{shrink:!0},...r,error:!!s.ten,helperText:(t=s.ten)==null?void 0:t.message,sx:{mb:2}})}})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(l,{name:"sdt",control:i,render:({field:r})=>{var t;return e.jsx(p,{fullWidth:!0,label:"Số điện thoại",variant:"outlined",InputLabelProps:{shrink:!0},...h("sdt"),error:!!s.sdt,helperText:(t=s.sdt)==null?void 0:t.message,sx:{mb:2}})}})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(l,{name:"email",control:i,render:({field:r})=>{var t;return e.jsx(p,{fullWidth:!0,label:"Email",variant:"outlined",InputLabelProps:{shrink:!0},...h("email"),error:!!s.email,helperText:(t=s.email)==null?void 0:t.message,sx:{mb:2}})}})}),e.jsx(n,{item:!0,xs:12,md:6,children:e.jsx(l,{name:"ngay_sinh",control:i,render:({field:r})=>{var t;return e.jsx(p,{type:"date",fullWidth:!0,label:"Ngày sinh",variant:"outlined",InputLabelProps:{shrink:!0},...r,error:!!s.ngay_sinh,helperText:(t=s.ngay_sinh)==null?void 0:t.message,sx:{mb:2}})}})}),e.jsx(n,{item:!0,xs:12,children:e.jsxs(v,{component:"fieldset",error:!!s.gioi_tinh,children:[e.jsx(me,{component:"legend",children:"Giới tính *"}),e.jsx(l,{name:"gioi_tinh",control:i,render:({field:r})=>e.jsxs(ge,{...r,row:!0,children:[e.jsx(M,{value:"1",control:e.jsx($,{}),label:"Nam"}),e.jsx(M,{value:"0",control:e.jsx($,{}),label:"Nữ"})]})}),s.gioi_tinh&&e.jsx(q,{children:s.gioi_tinh.message})]})}),e.jsx(n,{item:!0,xs:12,md:4,children:e.jsxs(v,{fullWidth:!0,sx:{mb:2},children:[e.jsx(_,{children:"Tỉnh/Thành Phố *"}),e.jsx(l,{name:"idTinhThanhPho",control:i,render:({field:r})=>e.jsx(T,{...r,value:u,onChange:t=>Q(t.target.value),children:R.map(t=>e.jsx(x,{value:t.ProvinceID,children:t.ProvinceName},t.ProvinceID))})})]})}),e.jsx(n,{item:!0,xs:12,md:4,children:e.jsxs(v,{fullWidth:!0,sx:{mb:2},children:[e.jsx(_,{children:"Quận/Huyện *"}),e.jsx(l,{name:"district",control:i,render:({field:r})=>e.jsxs(T,{...r,value:m,onChange:t=>Y(t.target.value),children:[e.jsx(x,{value:"",children:"Chọn quận/huyện"}),K.map(t=>e.jsx(x,{value:t.DistrictID,children:t.DistrictName},t.DistrictID))]})})]})}),e.jsx(n,{item:!0,xs:12,md:4,children:e.jsxs(v,{fullWidth:!0,sx:{mb:2},children:[e.jsx(_,{children:"Phường/Xã *"}),e.jsx(l,{name:"ward",control:i,render:({field:r})=>e.jsxs(T,{...r,value:E,onChange:t=>J(t.target.value),children:[e.jsx(x,{value:"",children:"Chọn phường/xã"}),U.map(t=>e.jsx(x,{value:t.WardCode,children:t.WardName},t.WardCode))]})})]})}),e.jsx(n,{item:!0,xs:12,children:e.jsx(l,{name:"dia_chi",control:i,render:({field:r})=>{var t;return e.jsx(p,{...r,label:"Địa chỉ Nhận Hàng",multiline:!0,rows:4,style:{marginBottom:"30px"},fullWidth:!0,InputLabelProps:{shrink:!0},error:!!s.dia_chi,helperText:(t=s.dia_chi)==null?void 0:t.message})}})}),e.jsxs(n,{item:!0,xs:12,children:[e.jsx(H,{display:"flex",justifyContent:"center",children:e.jsx(P,{type:"submit",variant:"contained",color:"primary",style:{width:"150px"},children:V?e.jsx(Se,{size:24}):"Lưu"})}),W&&e.jsx(q,{error:!0,children:W})]})]})})]})}),e.jsx(De,{open:ee,autoHideDuration:6e3,onClose:I,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(Ce,{onClose:I,variant:"filled",severity:re,sx:{width:"100%"},children:te})}),e.jsxs(we,{open:ie,onClose:()=>w(!1),children:[e.jsx(_e,{children:"Xác nhận lưu"}),e.jsx(Te,{children:e.jsx(Ee,{children:"Bạn có chắc chắn muốn lưu thông tin này không?"})}),e.jsxs(Pe,{children:[e.jsx(P,{onClick:()=>w(!1),color:"primary",children:"Hủy"}),e.jsx(P,{onClick:()=>w(!0),color:"primary",autoFocus:!0,children:"Xác nhận"})]})]})]})}export{Ge as default};
