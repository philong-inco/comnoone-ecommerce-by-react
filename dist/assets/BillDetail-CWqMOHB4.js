import{aa as E,j as e,G as l,T as r,C as ae,ak as te,Z as m,V as A,a2 as R,r as i,N as le,ac as Z,I as re}from"./index-DvRT1fKX.js";import{r as ce,u as oe,a as de,b as he}from"./billService-Tf_Smebm.js";import{b as $,c as xe,g as je,a as ge}from"./billStatus-xsKgi6wN.js";import{T as M,a as O,b as _,c as T,d as V}from"./TableRow-v48cNmg9.js";import{T as s}from"./TableCell-D2O8ZgxM.js";import{a as U,c as Y,b as F,D as J}from"./DialogTitle-CbNFobLJ.js";import{d as ue}from"./Delete-BuKFiIz4.js";import{g as me,a as pe,c as fe,b as be,d as ye,e as Ce}from"./serialUtil-Bcu-6NxW.js";import{B as L}from"./Box-f6O_cHq4.js";import{C as Se}from"./Checkbox-3H8dwV62.js";import{P as ve}from"./Pagination-8TToOB7Y.js";import{S as Te,A as Pe}from"./Snackbar-C3pqssDN.js";import"./request-CUTnW2PP.js";import{f as Ie,a as Ne,b as De}from"./index-BiQcOOa5.js";import"./LastPage-NB82S8Aw.js";import"./Close-Bd2a-8hi.js";function He(p){const{billHistory:f,handleLoading:x}=p,{id:u}=E(),d=()=>{x()},a=async()=>{try{(await ce(u)).status_code===201&&(alert("Quay lại thành công"),d())}catch(c){console.log(c),alert("Quay lại thất bại")}};return e.jsx("div",{children:e.jsxs(l,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",borderRadius:4},children:[e.jsx(l,{item:!0,xs:12,children:e.jsx(r,{variant:"h5",children:"Lịch sử đơn hàng"})}),e.jsx("div",{style:{display:"flex"},children:f.map(c=>e.jsx(l,{item:!0,xs:12,sm:6,md:3,sx:{display:"flex",flexDirection:"column",alignItems:"center",marginLeft:2},children:e.jsx(ae,{sx:{width:"100%",textAlign:"center"},children:e.jsxs(te,{sx:{padding:2},children:[e.jsx("img",{src:"https://via.placeholder.com/50",alt:"Hình ảnh",style:{width:"20%",height:"auto"}}),e.jsx(r,{variant:"h6",sx:{mt:1},children:$(c.trangThai)}),e.jsx(r,{variant:"body2",sx:{mt:1,fontSize:"0.875rem"},children:c.ngayTao})]})})},c.id))}),e.jsx(l,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-start",marginTop:0},children:e.jsx(m,{variant:"contained",color:"primary",onClick:a,children:"Quay lại trước đó"})})]})})}function Be(p){const{billHistory:f}=p,x=[{id:"amount",label:"Số tiền"},{id:"paymentDate",label:"Ngày thanh toán"},{id:"paymentMethod",label:"PTTT"},{id:"status",label:"Trạng Thái"},{id:"confirmedBy",label:"Người xác nhận"}],u=d=>{let a=d==="completed"?"success":"error";return e.jsx(R,{label:d,color:a,sx:{textTransform:"uppercase"}})};return e.jsxs(e.Fragment,{children:[e.jsx(l,{sx:{backgroundColor:"white",marginTop:2,padding:2,borderRadius:2},children:e.jsx(M,{component:A,children:e.jsxs(O,{children:[e.jsx(_,{children:e.jsx(T,{children:x.map(d=>e.jsx(s,{children:d.label},d.id))})}),e.jsx(V,{children:f.map((d,a)=>e.jsx(T,{children:x.map(c=>e.jsx(s,{children:c.id==="status"?u(d[c.id]):d[c.id]},c.id))},a))})]})})}),e.jsx(l,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",marginTop:1,borderRadius:4},children:"Lịch sử thanh toán ở đây"})]})}function ke(p){const{id:f}=E(),{billHistory:x,handleLoading:u,bill:d}=p,[a,c]=i.useState(!1),b=()=>{c(!0)},g=()=>{c(!1)},y=()=>{u()},j=[{id:"ngayTao",label:"Thời gian"},{id:"nguoiSua",label:"Người chỉnh sửa"},{id:"trangThai",label:"Trạng Thái"},{id:"ghiChuChoCuaHang",label:"Ghi chú của hàng"},{id:"ghiChuChoKhachHang",label:"Ghi chú khách hàng"}],I=async()=>{const h=await oe(f,"HUY");h.status_code==204&&(y(),alert(`Thông báo : Hủy hóa đơn ${f} thành công`)),console.log(h.status_code)};return e.jsxs(l,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",marginTop:1,borderRadius:4},children:[e.jsxs(l,{container:!0,spacing:2,children:[e.jsxs(l,{item:!0,xs:6,sx:{display:"flex",justifyContent:"flex-start"},children:[e.jsx(m,{variant:"contained",color:"error",onClick:I,disabled:d.trangThai==="HUY",sx:{marginRight:2},children:"HỦY"}),e.jsx(m,{variant:"contained",disabled:d.trangThai==="HUY",children:"XÁC NHẬN"})]}),e.jsxs(l,{item:!0,xs:6,sx:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(m,{variant:"contained",sx:{marginRight:2},children:"IN HÓA ĐƠN"}),e.jsx(m,{variant:"contained",sx:{marginRight:2},children:"IN PHIẾU GIAO HÀNG"}),e.jsxs(m,{variant:"contained",color:"warning",onClick:b,children:["CHI TIẾT"," "]})]})]}),e.jsxs(U,{open:a,onClose:g,maxWidth:"md",fullWidth:!0,children:[e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(r,{variant:"h5",children:["Chi tiết lịch sử thay đổi hóa đơn : ",e.jsx("strong",{children:f})]}),e.jsx(m,{onClick:g,children:"Đóng"})]}),e.jsx(F,{children:e.jsx(M,{component:A,children:e.jsxs(O,{children:[e.jsx(_,{children:e.jsx(T,{children:j.map(h=>e.jsx(s,{children:h.label},h.id))})}),e.jsx(V,{children:x.map((h,v)=>e.jsxs(T,{children:[e.jsx(s,{children:h.ngayTao}),e.jsx(s,{children:h.nguoiSua}),e.jsx(s,{children:e.jsx(R,{label:$(h.trangThai),sx:{backgroundColor:xe(h.trangThai),color:"#fff"}})}),e.jsx(s,{children:h.ghiChuChoCuaHang}),e.jsx(s,{children:h.ghiChuChoKhachHang})]},v))})]})})})]})]})}function we({onProductSelected:p,handleLoading:f,handleLoadingTimeLine:x,selectedSerialIds:u=[]}){const{id:d}=E(),[a,c]=i.useState([]),[b,g]=i.useState({open:!1,message:"",severity:"success"}),[y,j]=i.useState(!1),[I,h]=i.useState(null),[v,N]=i.useState(u),[D,W]=i.useState([]),[w,B]=i.useState(null),[k,t]=i.useState(1),[C,o]=i.useState(5),[S,P]=i.useState(0),G=async()=>{const n=await pe();n.code===200&&c(n.data)},X=async(n,H,K)=>{const z=await be(n,H-1,K);z.status_code===200&&(W(z.data.result),P(z.data.meta.total),t(z.data.meta.page+1))},ee=n=>{B(n),X(n,k,5),j(!0)},q=()=>{j(!1),N([]),t(1),B(null),h(null)},se=async()=>{(await fe({billCode:d,listSerialNumberId:v})).status_code===201&&(j(!1),N([]),t(1),B(null),h(null),alert("Oke"))},ne=n=>{N(H=>H.includes(n)?H.filter(K=>K!==n):[...H,n])};i.useEffect(()=>{G()},[]);const ie=n=>{N(v),t(n),X(w,n,C)};return e.jsxs(A,{sx:{padding:2},children:[e.jsx(l,{container:!0,spacing:2,marginBottom:2,children:e.jsx(l,{item:!0,xs:12,children:e.jsx(r,{variant:"h6",children:"Tìm kiếm"})})}),e.jsx(M,{sx:{maxHeight:"70vh"},children:e.jsxs(O,{stickyHeader:!0,children:[e.jsx(_,{children:e.jsxs(T,{children:[e.jsx(s,{children:"Ảnh"}),e.jsx(s,{children:"Tên"}),e.jsx(s,{children:"Mã"}),e.jsx(s,{children:"Bàn phím"}),e.jsx(s,{children:"CPU"}),e.jsx(s,{children:"Màn hình"}),e.jsx(s,{children:"Màu sắc"}),e.jsx(s,{children:"RAM"}),e.jsx(s,{children:"VGA"}),e.jsx(s,{children:"Webcam"}),e.jsx(s,{children:"Ổ cứng"}),e.jsx(s,{children:"Giá"}),e.jsx(s,{children:"Thao tác"})]})}),e.jsx(V,{children:a.map(n=>e.jsxs(T,{children:[e.jsx(s,{children:e.jsx("img",{src:"https://via.placeholder.com/50",alt:"Product",width:"50"})}),e.jsx(s,{children:n.sanPham}),e.jsx(s,{children:n.ma}),e.jsx(s,{children:n.banPhim}),e.jsx(s,{children:n.cpu}),e.jsx(s,{children:n.manHinh}),e.jsx(s,{children:n.mauSac}),e.jsx(s,{children:n.ram}),e.jsx(s,{children:n.vga}),e.jsx(s,{children:n.webcam}),e.jsx(s,{children:n.ocung}),e.jsx(s,{children:e.jsxs(r,{color:"error",children:[parseInt(n.giaBan).toLocaleString()," VNĐ"]})}),e.jsx(s,{children:e.jsx(m,{variant:"contained",color:"primary",onClick:()=>ee(n.id),children:"Chọn"})})]},n.id))})]})}),e.jsxs(U,{open:y,onClose:q,PaperProps:{style:{width:"700px"}},children:[e.jsx(Y,{children:e.jsxs(L,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:"Danh sách serial"}),e.jsx(le,{variant:"outlined",size:"small",label:"Tìm kiếm",style:{marginRight:"16px"}})]})}),e.jsxs(F,{children:[e.jsx(M,{component:A,children:e.jsxs(O,{children:[e.jsx(_,{children:e.jsxs(T,{children:[e.jsx(s,{children:"Chọn"}),e.jsx(s,{children:"Mã"}),e.jsx(s,{children:"Trạng thái"})]})}),e.jsx(V,{children:D.map(n=>e.jsxs(T,{children:[e.jsx(Se,{checked:v.includes(n.id),onChange:()=>ne(n.id),disabled:n.trangThai===1&&!v.includes(n.id)}),e.jsx(s,{children:n.ma}),e.jsx(s,{children:e.jsx(R,{label:n.trangThai==0?"Còn hàng":n.trangThai==1?"Đã bán":"Hủy",style:{backgroundColor:me(n.trangThai),color:"#fff"},size:"small"})})]},n.id))})]})}),e.jsx(ve,{sx:{marginTop:"10px",textAlign:"center"},count:Math.ceil(S/C),page:k,onChange:(n,H)=>ie(H)})]}),e.jsxs(J,{children:[e.jsx(m,{onClick:q,children:"Hủy"}),e.jsx(m,{onClick:()=>{se()},variant:"contained",color:"primary",children:"Xác nhận"})]})]}),e.jsx(Te,{open:b.open,autoHideDuration:3e3,onClose:()=>g({...b,open:!1}),children:e.jsx(Pe,{onClose:()=>g({...b,open:!1}),severity:b.severity,children:b.message})})]})}function Le(p){const{handleLoading:f,bill:x,fetchBill:u}=p,{id:d}=E(),[a,c]=i.useState(!1),[b,g]=i.useState(!1),[y,j]=i.useState([]),[I,h]=i.useState([]),[v,N]=i.useState({open:!1,message:"",severity:"success"}),D=async()=>{const o=await ye(d);if(o.status_code===200){h(o.data);const S=o.data.flatMap(P=>P.serialNumbers.map(G=>G.serialNumberId));j(S)}},W=async(o,S)=>{const P=await Ce(o,S);P.status_code===200&&(N({open:!0,message:P.message,severity:"success"}),D(),u(),alert("Oke"))};i.useEffect(()=>{D()},[a]);const w=()=>{g(!1)},B=()=>{c(!a)},k=()=>{g(!b)},t=()=>{g(!1)},C=o=>{console.log("Value : ",o);const S=o.serialNumbers.map(G=>G.serialNumberId);console.log("data : ",{billCode:d,serialNumberIds:S}),W(d,S)};return e.jsxs(e.Fragment,{children:[e.jsx(l,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",marginTop:1,borderRadius:4},children:e.jsxs(A,{sx:{padding:2,marginTop:2,borderRadius:2,width:"100%"},children:[e.jsx(l,{container:!0,spacing:2,children:e.jsxs(l,{item:!0,xs:12,container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsx(r,{variant:"h5",children:"Danh sách sản phẩm"}),e.jsx(m,{variant:"contained",color:"warning",onClick:k,disabled:x.trangThai=="HUY",children:"Thêm sản phẩm"})]})}),e.jsxs(U,{open:b,onClose:w,maxWidth:"xl",fullWidth:!0,children:[e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{variant:"h5",children:"Danh sách sản phẩm"}),e.jsx(m,{onClick:w,children:"Đóng"})]}),e.jsx(F,{children:e.jsx(we,{handleLoading:B,handleLoadingTimeLine:f,onProductSelected:t,selectedSerialIds:y})})]}),e.jsx(Z,{sx:{marginY:2}}),e.jsx(M,{component:A,sx:{width:"100%"},children:e.jsxs(O,{"aria-label":"simple table",children:[e.jsx(_,{children:e.jsxs(T,{children:[e.jsx(s,{children:"Ảnh"}),e.jsx(s,{children:"Mã SP"}),e.jsx(s,{children:"Tên sản phẩm"}),e.jsx(s,{children:"Giá"}),e.jsx(s,{children:"Số lượng"}),e.jsx(s,{children:"Thành tiền"}),e.jsx(s,{children:"Serial"}),e.jsx(s,{children:"Hành động"})]})}),e.jsx(V,{children:I.map(o=>e.jsxs(T,{children:[e.jsx(s,{children:e.jsx("img",{src:"https://via.placeholder.com/50",alt:"Product",width:"50"})}),e.jsx(s,{children:o.productDetailCode}),e.jsx(s,{children:o.productName}),e.jsx(s,{children:e.jsxs("strong",{children:[parseInt(o.price).toLocaleString()," VNĐ"]})}),e.jsx(s,{children:e.jsxs("strong",{children:[o.quantity," "]})}),e.jsx(s,{children:e.jsxs("strong",{children:[parseInt(o.quantity*o.price).toLocaleString()," VNĐ"]})}),e.jsx(s,{children:e.jsx("strong",{children:o.serialNumbers.map((S,P)=>e.jsxs("span",{children:[S.serialNumberCode,P<o.serialNumbers.length-1&&", "]},S.serialNumberId))})}),e.jsx(s,{children:e.jsx(re,{color:"error",onClick:()=>C(o),children:e.jsx(ue,{})})})]},o.id))})]})})]})}),e.jsxs(l,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",marginTop:1,borderRadius:4},children:[e.jsx(l,{item:!0,xs:9,sx:{display:"flex",justifyContent:"flex-start"},children:e.jsxs(r,{children:["Phiếu giảm giá : ",e.jsx("strong",{children:x.maPGG})]})}),e.jsxs(l,{item:!0,xs:3,sx:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[e.jsxs(r,{children:[e.jsx("strong",{children:" Tổng tiền hàng : "})," ",e.jsxs("strong",{style:{color:"red",marginLeft:"8px"},children:[" ",parseInt(x.tongTienBanDau).toLocaleString()," VNĐ"]})]}),e.jsxs(r,{children:["Giá trị giảm :",e.jsxs("strong",{children:[x.giaTriPhieuGiamGia," ",x.loaiPGG==1?"%":"VNĐ"]})]}),e.jsx(r,{children:"Phí vận chuyển :"}),e.jsx(Z,{sx:{width:"100%",marginY:1}}),e.jsxs(r,{children:[e.jsx("strong",{children:"Tổng tiền :"}),e.jsxs("strong",{style:{color:"red",marginLeft:"8px"},children:[" ",parseInt(x.tongTienPhaiTra).toLocaleString()," VNĐ"]})]})]})]})]})}const Re=()=>{const[p,f]=i.useState([]),[x,u]=i.useState([]),[d,a]=i.useState([]),[c,b]=i.useState(""),[g,y]=i.useState(""),[j,I]=i.useState(""),[h,v]=i.useState(!1),N=()=>v(!0),D=()=>v(!1);i.useEffect(()=>{(async()=>{const C=await Ie();f(C.data)})()},[]);const W=async t=>{const C=t.target.value;b(C);const o=await Ne(C);u(o.data),y(""),I(""),a([])},w=async t=>{const C=t.target.value;y(C);const o=await De(C);a(o.data),I("")},B=t=>{I(t.target.value)},k=t=>{t.preventDefault(),console.log("Selected Address:",{province:c,district:g,ward:j}),D()};return e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"contained",color:"primary",onClick:N,children:"Cập nhập địa chỉ"}),e.jsxs(U,{open:h,onClose:D,maxWidth:"md",fullWidth:!0,children:[e.jsx(Y,{children:"Chọn Địa Chỉ"}),e.jsx(F,{children:e.jsxs("form",{onSubmit:k,children:[e.jsx("div",{style:{marginBottom:"16px",width:"100%"},children:e.jsxs("select",{id:"province",value:c,onChange:W,style:Q,children:[e.jsx("option",{value:"",children:"Chọn Tỉnh/Thành Phố"}),p.map(t=>e.jsx("option",{value:t.ProvinceID,children:t.ProvinceName},t.ProvinceID))]})}),e.jsx("div",{style:{marginBottom:"16px",width:"100%"},children:e.jsxs("select",{id:"district",value:g,onChange:w,disabled:!c,style:Q,children:[e.jsx("option",{value:"",children:"Chọn Quận/Huyện"}),x.map(t=>e.jsx("option",{value:t.DistrictID,children:t.DistrictName},t.DistrictID))]})}),e.jsx("div",{style:{marginBottom:"16px",width:"100%"},children:e.jsxs("select",{id:"ward",value:j,onChange:B,disabled:!g,style:Q,children:[e.jsx("option",{value:"",children:"Chọn Phường/Xã"}),d.map(t=>e.jsx("option",{value:t.WardCode,children:t.WardName},t.WardCode))]})})]})}),e.jsxs(J,{children:[e.jsx(m,{onClick:D,color:"secondary",children:"Hủy"}),e.jsx(m,{onClick:k,color:"primary",children:"Xác Nhận"})]})]})]})},Q={width:"100%",padding:"8px",border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:"4px",fontSize:"16px",lineHeight:"1.5",transition:"border-color 0.3s, box-shadow 0.3s",appearance:"none",backgroundColor:"white","&:hover":{borderColor:"rgba(0, 0, 0, 0.87)"},"&:focus":{borderColor:"#3f51b5",boxShadow:"0 0 0 2px rgba(63, 81, 181, 0.2)"},"&:disabled":{backgroundColor:"#f5f5f5",cursor:"not-allowed"}};function Ze(){const{id:p}=E(),[f,x]=i.useState(!1),[u,d]=i.useState([]),[a,c]=i.useState({}),b=async()=>{const j=await de(p);j.status_code===200&&d(j.data)},g=async()=>{const j=await he(p);j.status_code===200&&c(j.data)};i.useEffect(()=>{b(),g()},[p,f]);const y=()=>{x(j=>!j),g()};return e.jsxs(e.Fragment,{children:[e.jsxs(r,{variant:"h4",sx:{marginBottom:3},children:["Quản lý đơn hàng :"," ",e.jsx(r,{component:"span",sx:{color:"gray"},children:a.ma})]}),e.jsx(He,{billHistory:u,handleLoading:y}),e.jsx(ke,{billHistory:u,bill:a,handleLoading:y}),e.jsxs(l,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",borderRadius:4,mt:1},children:[e.jsx(l,{item:!0,xs:10,children:e.jsx(r,{variant:"h5",children:"Thông tin đơn hàng"})}),e.jsx(l,{item:!0,xs:2,container:!0,justifyContent:"flex-end",children:e.jsx(Re,{})}),e.jsxs(l,{item:!0,xs:4,children:[e.jsx(r,{variant:"body1",children:"Mã:"}),e.jsx(r,{variant:"body1",sx:{fontWeight:"bold",ml:1},children:a.ma})]}),e.jsx(l,{item:!0,xs:4,children:e.jsxs(L,{display:"flex",alignItems:"center",children:[e.jsx(r,{variant:"body1",children:"Tên khách hàng:"}),a.tenKhachHang===null?e.jsx(R,{label:"Khách lẻ",color:"info",sx:{ml:1}}):e.jsx(r,{variant:"body1",sx:{ml:1},children:a.tenKhachHang})]})}),e.jsx(l,{item:!0,xs:4,children:e.jsxs(L,{display:"flex",alignItems:"center",children:[e.jsx(r,{variant:"body1",children:"Trạng thái:"}),e.jsx(R,{label:je(a.trangThai),sx:{ml:1,backgroundColor:ge(a.trangThai),color:"#fff"}})]})}),e.jsx(l,{item:!0,xs:4,children:e.jsxs(L,{display:"flex",alignItems:"center",children:[e.jsx(r,{variant:"body1",children:"SĐT người nhận:"}),e.jsx(r,{variant:"body1",sx:{ml:1},children:a.sdt})]})}),e.jsx(l,{item:!0,xs:4,children:e.jsxs(L,{display:"flex",alignItems:"center",children:[e.jsx(r,{variant:"body1",children:"Loại hóa đơn:"}),e.jsx(R,{label:a.loaiHoaDon=="0"?"Tại quầy":"Online",color:a.loaiHoaDon=="0"?"primary":"success",sx:{ml:1}})]})}),e.jsx(l,{item:!0,xs:4,children:e.jsxs(L,{display:"flex",alignItems:"center",children:[e.jsx(r,{variant:"body1",children:"Tên người nhận:"}),e.jsx(r,{variant:"body1",sx:{ml:1},children:" ???"})]})})]}),e.jsx(Be,{billHistory:u}),e.jsx(Le,{handleLoading:y,bill:a,fetchBill:g})]})}export{Ze as default};
