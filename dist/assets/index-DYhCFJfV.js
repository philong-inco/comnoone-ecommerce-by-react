import{q as O,j as e,b as P,G as x,f as w,E as v,m as B,D as X,n as Y,R as J,i as I,k as H,B as N,d as Q,e as L,h as Z,r as s,c as ee}from"./index-DkjfH3Nj.js";import{g as te,c as ae}from"./billService-LSyzHNP3.js";import{A as ne}from"./Add-BmWZAlNn.js";import{g as le,a as oe}from"./billStatus-C6FG20SU.js";import{d as se}from"./Visibility-CDUyuOxh.js";import{T as re,a as ie}from"./Tabs-DFJbw4kS.js";import{T as de,a as ce,b as he,c as $,d as me}from"./TableRow-DrBFg2V4.js";import{T as z}from"./TableCell-BUbxn9S2.js";import{T as ue}from"./TablePagination-De1m2AAw.js";import"./request-DcjhHzTt.js";import"./KeyboardArrowRight-BY8qYOjh.js";import"./LastPage-CMxtDi2C.js";import"./MenuItem-B1FZ8Sxq.js";const ge=O(e.jsx("path",{d:"M19 9h-4V3H9v6H5l7 7zM5 18v2h14v-2z"}),"FileDownload"),xe=O(e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14"}),"Search");function pe(T){const{handleSearch:u,handleCreateBill:k,onDateChange:f,fromDate:o,toDate:p,handleBillTypeChange:r,handlePrint:j}=T,i=P(),g=d=>{const{name:b,value:h}=d.target;f(b,h)};return e.jsxs("div",{style:{backgroundColor:"white",padding:"10px",borderRadius:"10px"},children:[e.jsxs(x,{container:!0,spacing:2,className:"mb-10",children:[e.jsx(x,{item:!0,xs:12,sm:6,children:e.jsx(w,{fullWidth:!0,placeholder:"Tìm kiếm mã hóa đơn , sdt , email",InputProps:{startAdornment:e.jsx(xe,{style:{marginRight:"8px"}})},onChange:d=>u(d.target.value),variant:"outlined",size:"small"})}),e.jsxs(x,{item:!0,xs:12,sm:6,container:!0,justifyContent:"flex-end",children:[e.jsx(v,{title:"Tải file excel",arrow:!0,placement:"top",children:e.jsx(B,{variant:"outlined",color:"primary",style:{marginLeft:"10px"},onClick:j,children:e.jsx(ge,{})})}),e.jsx(v,{title:"Tạo hóa đơn",arrow:!0,placement:"top",children:e.jsx(B,{variant:"contained",color:"primary",onClick:()=>{i("/ban-hang")},style:{marginLeft:"10px"},children:e.jsx(ne,{})})})]})]}),e.jsx(X,{style:{margin:"10px 0"}}),e.jsxs(x,{container:!0,spacing:2,children:[e.jsx(x,{item:!0,xs:6,sm:3,children:e.jsx(w,{label:"Từ ngày",type:"date",name:"tuNgay",value:o||"",onChange:g,fullWidth:!0,InputLabelProps:{shrink:!0}})}),e.jsx(x,{item:!0,xs:6,sm:3,children:e.jsx(w,{label:"Đến ngày",name:"denNgay",type:"date",value:p||"",onChange:g,fullWidth:!0,InputLabelProps:{shrink:!0}})}),e.jsx(x,{item:!0,xs:12,sm:6,container:!0,alignItems:"center",style:{display:"flex"},children:e.jsx(Y,{component:"fieldset",style:{display:"flex",flexDirection:"row",alignItems:"center"},children:e.jsxs(J,{row:!0,defaultValue:"",onChange:r,style:{display:"flex",flexDirection:"row"},children:[e.jsx(I,{value:"",control:e.jsx(H,{}),label:"Tất cả"}),e.jsx(I,{value:"0",control:e.jsx(H,{}),label:"Tại quầy"}),e.jsx(I,{value:"1",control:e.jsx(H,{}),label:"Online"})]})})})]})]})}function ye(T){const{activeKey:u,handleTabChange:k,bills:f,page:o,pageSize:p,total:r,onPageChange:j}=T,i=P(),g=[{key:"",label:"TẤT CẢ"},{key:"DON_MOI",label:"Đơn mới"},{key:"CHO_XAC_NHAN",label:"Chờ xác nhận"},{key:"CHO_GIAO",label:"Chờ giao"},{key:"DANG_GIAO",label:"Đang giao"},{key:"TRA_HANG_HOAN_TIEN",label:"Trả hàng hoàn tiền"},{key:"HOAN_THANH",label:"Hoàn thành"},{key:"HUY",label:"Hủy"}],d=a=>{console.log("Code",a),i(`/hoa-don/chi-tiet/${a}`)},b=a=>{const n=a.tongTienPhaiTra,c=a.tienShip||0;return a.tienGiamHangKhachHang,n+c},h=[{title:"STT",dataIndex:"key",key:"key"},{title:"Mã",dataIndex:"ma",key:"ma"},{title:"Tổng SP",dataIndex:"tongSanPham",key:"tongSanPham"},{title:"Tổng số tiền",dataIndex:"tongTienPhaiTra",key:"tongTien",render:(a,n)=>b(n).toLocaleString()},{title:"Tên khách hàng",dataIndex:"tenKhachHang",key:"tenKhachHang",render:a=>a??"Khách lẻ"},{title:"SDT",dataIndex:"sdt",key:"sdt"},{title:"Email",dataIndex:"email",key:"email"},{title:"Ngày tạo",dataIndex:"ngayTao",key:"ngayTao"},{title:"Loại hóa đơn",dataIndex:"loaiHoaDon",key:"loaiHoaDon",render:a=>e.jsx(v,{title:a==0?"Bán tại quầy":"Hóa đơn bán giao hang",arrow:!0,placement:"top",children:e.jsx(L,{size:"small",sx:{width:100,color:"white",fontWeight:"bold",fontSize:"0.8rem",padding:"15px 4px"},label:a==0?"Tại quầy":"Ship",color:a==0?"primary":"success"})})},{title:"Trạng thái",dataIndex:"trangThai",key:"trangThai",render:a=>e.jsx(L,{label:le(a),style:{backgroundColor:oe(a),color:"#fff"},size:"small",Chip:!0,sx:{width:100,color:"white",fontWeight:"bold",fontSize:"0.8rem",padding:"15px 4px"}})},{title:"Hành động",key:"action",render:(a,n)=>e.jsx(e.Fragment,{children:e.jsx(v,{title:"Xem chi tiết",children:e.jsx(Z,{onClick:()=>d(n.ma),children:e.jsx(se,{})})})})}];return e.jsxs(N,{sx:{backgroundColor:"white",marginTop:"10px",borderRadius:"10px",padding:"10px"},children:[e.jsx(re,{value:u,onChange:(a,n)=>k(n),variant:"fullWidth",scrollButtons:"auto",allowScrollButtonsMobile:!0,children:g.map(a=>e.jsx(ie,{label:a.label,value:a.key,sx:{marginLeft:"10px"}},a.key))}),g.map(a=>e.jsx(N,{hidden:u!==a.key,sx:{marginTop:"20px"},children:u===a.key&&e.jsxs(e.Fragment,{children:[e.jsx(de,{component:Q,children:e.jsxs(ce,{"aria-label":"simple table",children:[e.jsx(he,{children:e.jsx($,{children:h.map(n=>e.jsx(z,{children:n.title},n.key))})}),e.jsx(me,{children:f.map((n,c)=>e.jsx($,{children:h.map(m=>e.jsx(z,{children:m.key==="key"?c+1:m.render?m.render(n[m.dataIndex],n):n[m.dataIndex]},m.key))},n.id))})]})}),e.jsx(ue,{component:"div",count:r,page:o-1,onPageChange:(n,c)=>j(c+1),rowsPerPage:p,rowsPerPageOptions:[5]})]})},a.key))]})}function Ae(){P();const[T,u]=s.useState(""),[k,f]=s.useState([]),[o,p]=s.useState(null),[r,j]=s.useState(null),[i,g]=s.useState(""),[d,b]=s.useState(""),[h,a]=s.useState(""),[n,c]=s.useState(1),[m,_]=s.useState(5),[F,R]=s.useState(0),[E,D]=s.useState(!1),S=(t,l=!0)=>{if(!t)return null;const y=new Date(t);return isNaN(y.getTime())?(console.error("Lỗi : ",t),null):(l?y.setHours(0,0,0,0):y.setHours(23,59,59,999),y.getTime())},A=async()=>{if(E)return;D(!0);let t=` ( ma ~~ '${i.trim()}' or sdt ~~ '${i.trim()}' or email ~~ '${i.trim()}') `;d&&(t+=` and loaiHoaDon:${d}`),h&&(t+=` and trangThai:'${h}'`),o&&r&&(t+=` and ngayTao >: '${S(o,!0)}' and ngayTao <:'${S(r,!1)}'   `);try{const l=await te(n-1,m,t);l.status_code===200&&(f(l.data.result),c(l.data.meta.page+1),_(l.data.meta.pageSize),R(l.data.meta.total))}catch(l){console.error("Lỗi : ",l)}finally{D(!1)}},G=async()=>{let t=` ( ma ~~ '${i.trim()}' or sdt ~~ '${i.trim()}' or email ~~ '${i.trim()}') `;d&&(t+=` and loaiHoaDon:${d}`),h&&(t+=` and trangThai:'${h}'`),o&&r&&(t+=` and ngayTao >: '${S(o,!0)}' and ngayTao <:'${S(r,!1)}'   `);try{const l=await ee({url:"http://localhost:8080/api/bills/export",method:"GET",params:{filter:t},responseType:"blob"}),y=window.URL.createObjectURL(new Blob([l.data])),C=document.createElement("a");C.href=y,C.setAttribute("download","hoadon.xlsx"),document.body.appendChild(C),C.click(),document.body.removeChild(C)}catch(l){console.error("Lỗi in hóa đơn: ",l)}},M=t=>{console.log(`PAGE ${t}`),c(t)},K=t=>{g(t),c(1)},W=t=>{b(t.target.value)},q=(t,l)=>{t==="tuNgay"&&l!==null?p(l):t==="denNgay"&&l!==null&&j(l),console.table(o,r)},U=async()=>{try{const t=await ae();t.status_code===201&&(alert("Thông báo Oke : "+t.data.ma),A())}catch(t){alert("Thông báo Error : "+t.response.data.error)}};s.useEffect(()=>{A()},[o,r,i,d,h,n]);const V=t=>{c(1),a(t),u(t)};return e.jsxs(e.Fragment,{children:[e.jsx(pe,{handleSearch:K,handleCreateBill:U,onDateChange:q,fromDate:o,toDate:r,handleBillTypeChange:W,handlePrint:G}),e.jsx(ye,{activeKey:T,handleTabChange:V,bills:k,page:n,pageSize:m,total:F,onPageChange:M})]})}export{Ae as default};
