import{w as Ze,n as en,j as e,z as nn,E as tn,a as Ce,r as n,B as le,G as i,T as b,h as ce,f as ee,i as T,d as Re,A as de,k as be,p as ve,m as ke,aR as an,aS as sn,g as on,S as rn,e as ln,b as Ae}from"./index-BNYZeP1T.js";import{d as cn}from"./Add-Brohz889.js";import{d as hn}from"./ShoppingCart-3-1Uh-8f.js";import{p as Fe,b as dn,d as un,l as gn,e as Oe,f as We,c as xn}from"./billService-B4Fb4oi8.js";import{g as pn}from"./request-RmJ5MMbn.js";import{B as mn}from"./react-toastify.esm-BxIjmUbr.js";import{N as fn}from"./notification-B40vY8uZ.js";import{a as jn,g as Cn,d as yn,f as Sn,b as He,c as Ie,e as Tn,h as bn,C as vn,S as kn}from"./CouponDiaLog-BT8D9Qht.js";import{f as Dn,e as Pn}from"./customerService-CtLwVgr-.js";import{D as Q,a as J,b as Z,c as Me}from"./DialogTitle-Be73EMa2.js";import{T as Ee,a as De,b as Ge,c as he,d as Pe}from"./TableRow-WD6ivono.js";import{T as m}from"./TableCell-BaxNxya6.js";import{T as ae}from"./Tooltip-BRa6HpAb.js";import{P as wn}from"./Pagination-CaP9kSWl.js";import{S as ue}from"./Snackbar-6sEUqhGB.js";import{G as Hn}from"./index-BtDF2PEn.js";import{D as In,B as Bn}from"./Delete-CAwy6bSa.js";import{M as te}from"./MenuItem-BCdLiv3n.js";import{B as Ln}from"./ImportProduct-BfKLY25y.js";import{F as Be}from"./FormControlLabel-L0ky9wc-.js";import{S as Le}from"./Switch-CAXWQjo8.js";import{F as Nn}from"./Fab-Br1esWDD.js";import{T as Rn,a as Ne}from"./Tabs-CKck-Mbg.js";import{D as An}from"./DialogContentText-B3t5_teJ.js";import"./RadioGroup-DT3_IQ6w.js";import"./SwitchBase-BS7_TVRV.js";import"./TablePagination-B_CkhwHZ.js";import"./KeyboardArrowRight-BZUhZXMz.js";import"./LastPage-ne3A1-i7.js";import"./Checkbox-DiRzef1N.js";import"./IconTrash-vjDrAV3d.js";import"./couponsService-1cb7-LRV.js";import"./usePreviousProps-BpNEy8fA.js";import"./xlsx-ChUIJHMt.js";import"./sanPham-BNBZ7jdE.js";import"./back-end-vuWvP0DO.js";var Fn=Ze("shopping-bag-discount","IconShoppingBagDiscount",[["path",{d:"M12.5 21h-3.926a3 3 0 0 1 -2.965 -2.544l-1.255 -8.152a2 2 0 0 1 1.977 -2.304h11.339a2 2 0 0 1 1.977 2.304l-.416 2.7",key:"svg-0"}],["path",{d:"M9 11v-5a3 3 0 0 1 6 0v5",key:"svg-1"}],["path",{d:"M16 21l5 -5",key:"svg-2"}],["path",{d:"M21 21v.01",key:"svg-3"}],["path",{d:"M16 16v.01",key:"svg-4"}]]);const On=en(e.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh");var we={},Wn=tn;Object.defineProperty(we,"__esModule",{value:!0});var _e=we.default=void 0,Mn=Wn(nn()),En=e;_e=we.default=(0,Mn.default)((0,En.jsx)("path",{d:"M3 5v4h2V5h4V3H5c-1.1 0-2 .9-2 2m2 10H3v4c0 1.1.9 2 2 2h4v-2H5zm14 4h-4v2h4c1.1 0 2-.9 2-2v-4h-2zm0-16h-4v2h4v4h2V5c0-1.1-.9-2-2-2"}),"CropFreeOutlined");const Gn="/assets/MB-Banl-BNcrzYqu.jpg",_n=C=>{const{id:x}=Ce(),s=n.useRef(),{open:y,onCloseDialog:D,data:o,onReload:f}=C;n.useState(!0);const[H,L]=n.useState([]),[P,N]=n.useState(""),[F,I]=n.useState(""),[G,v]=n.useState(0),[w,V]=n.useState(0),[k,_]=n.useState(!1),[u,X]=n.useState(0),[O,z]=n.useState(!1),[R,q]=n.useState(!1),[W,g]=n.useState(!1),[p,M]=n.useState(!1),[ne,E]=n.useState(""),[h,l]=n.useState("error"),[se,ge]=n.useState(!1),[Y,xe]=n.useState(null),[t,A]=n.useState(!1),B=c=>{N(c),_(!0)};console.log("DATA PAY : ",o);const oe=()=>{if(F===""||F===null||F==null){A(!0);return}else A(!1);const d={idHTTT:P==="cash"?1:2,soTien:o.tongTienPhaiTra+(o.loaiHoaDon==1?o.tienShip:0),tienNhan:parseFloat(F),loaiThanhToan:"0",loaiHoaDon:o.loaiHoaDon,ten:o.ten,sdt:o.sdt,email:o.email};console.log("Data veef HDHTT : ",d),pe(d),I(""),_(!1)},pe=async c=>{console.log(x),console.log("Chạy 0",o.ma);try{(await jn(o.ma,c)).status_code===201&&(E("Giao dịch thành công"),l("success"),M(!0),console.log("Chạy 2"),re())}catch(d){d.response&&E("Lỗi mạng hoặc không thể kết nối đến server."),l("error"),M(!0),console.log(d)}},me=()=>{M(!1)},re=async()=>{try{const c=await Cn(x);if(c.status_code===200){L(c.data);const d=c.data.filter($=>$.loaiThanhToan===0).reduce(($,ie)=>$+(ie.tienNhan||0),0);V(d)}}catch{}finally{}},ye=async c=>{try{await yn(c)&&(E("Hủy giao dịch thành công"),l("success"),M(!0),re())}catch(d){console.log(d),E("Hủy giao dịch thất bại"),l("error"),M(!0)}};n.useEffect(()=>{re()},[x]);const fe=()=>{q(!0);const c=localStorage.getItem("billCode");je(c),g(!1)},je=async c=>{try{const d=await fetch(`http://localhost:8080/api/bills/order-pdf/${c}`,{method:"GET",headers:{"Content-Type":"application/pdf"}});if(d.ok){E("In hóa đơn thành công"),l("success"),M(!0),g(!1);const $=await d.blob(),ie=URL.createObjectURL($);xe(ie),setTimeout(()=>{s.current.contentWindow.print()},500),f()}else console.error(d),console.error("Failed to fetch PDF")}catch(d){console.error("Error fetching PDF:",d),E("In hóa đơn thất bại"),l("error"),M(!0)}finally{localStorage.setItem("billCode",""),M(!0)}};n.useEffect(()=>{const c=o.loaiHoaDon===0?o.tongTienPhaiTra:o.tongTienPhaiTra+o.tienShip,d=c-w;v(d>0?d:0);const $=w-c;X($>0?$:0)},[w,o]);const U=()=>{console.log(o);const c={thanhToanSau:o.thanhToanSau,loaiHoaDon:o.loaiHoaDon,tienShip:o.tienShip,ten:o.tenKhachHang,sdt:o.sdt,email:o.email,diaChi:o.diaChi,tinh:o.tinh,tenTinh:o.tenTinh,huyen:o.huyen,tenHuyen:o.tenHuyen,phuong:o.phuong,tenPhuong:o.tenPhuong,ghiChu:o.ghiChu};console.log("new DATA : ",c),Se(c)},Se=async c=>{try{const d=await Fe(x,c);d.status_code===201&&(E("Xác nhận thanh toán thành công thành công"),l("success"),M(!0),_(!1),z(!1),D(),localStorage.setItem("billCode",d.data),g(!0),f())}catch(d){console.log(d),E("Không thể thực hiện thanh toán"),l("error"),M(!0)}},Te=()=>{ge(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs(Q,{open:y,onClose:D,fullWidth:!0,maxWidth:"md",children:[e.jsx(J,{variant:"h4",children:"Thanh toán"}),e.jsx(Z,{children:e.jsx(le,{children:e.jsxs(i,{container:!0,spacing:2,sx:{marginTop:2},children:[e.jsxs(i,{container:!0,alignItems:"center",children:[e.jsx(i,{item:!0,xs:6,style:{textAlign:"left"},children:e.jsxs(b,{variant:"h3",color:"error",children:["Cần thanh toán: ",(o.loaiHoaDon===0?o.tongTienPhaiTra:o.tongTienPhaiTra+o.tienShip).toLocaleString()," ","VNĐ"]})}),e.jsx(i,{item:!0,xs:6,style:{textAlign:"right"},children:e.jsx(ae,{title:"QR thanh toán",placement:"top",children:e.jsx(ce,{color:"primary","aria-label":"quét QR",onClick:Te,children:e.jsx(_e,{})})})})]}),e.jsx(i,{item:!0,xs:12,children:e.jsx(ee,{label:"Số tiền",type:"number",value:F,onChange:c=>{const d=c.target.value;(parseFloat(d)>=0||d!=="")&&I(d)},error:t,helperText:t?"Số tiền không được để trống":"",fullWidth:!0})}),e.jsx(i,{item:!0,xs:6,children:e.jsx(T,{variant:P==="cash"?"contained":"outlined",onClick:()=>B("cash"),fullWidth:!0,children:"Tiền mặt"})}),e.jsx(i,{item:!0,xs:6,children:e.jsx(T,{variant:P==="transfer"?"contained":"outlined",onClick:()=>B("transfer"),fullWidth:!0,children:"Chuyển khoản"})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(b,{variant:"h4",children:["Khách thanh toán : ",w.toLocaleString()," VNĐ"]})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(b,{variant:"h4",color:"error",children:["Tiền thiếu: ",G.toLocaleString()," VNĐ"]})}),e.jsx(i,{item:!0,xs:12,children:e.jsxs(b,{variant:"h4",children:["Tiền dư: ",u.toLocaleString()," VNĐ"]})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(Ee,{component:Re,sx:{maxHeight:400},children:e.jsxs(De,{children:[e.jsx(Ge,{children:e.jsxs(he,{children:[e.jsx(m,{children:"STT"}),e.jsx(m,{children:"Ngày tạo"}),e.jsx(m,{children:"Tiền nhận"}),e.jsx(m,{children:"Phương thanh toán"}),e.jsx(m,{children:"Trạng thái"}),e.jsx(m,{children:"Người tạo"}),e.jsx(m,{children:"Hành động"})]})}),e.jsx(Pe,{children:H.map((c,d)=>e.jsxs(he,{children:[e.jsx(m,{children:d+1}),e.jsx(m,{children:c.ngayTao}),e.jsx(m,{children:c.tienNhan?c.tienNhan.toLocaleString()+" đ":""}),e.jsx(m,{children:c.phuongThanhToan===1?"Tiền mặt":"Chuyển khoản"}),e.jsx(m,{children:c.loaiThanhToan===0?"Thanh toán":"Trả Sau"}),e.jsx(m,{children:c.nguoiTao?c.nguoiTao:"Chưa xác định"}),e.jsxs(m,{children:[e.jsx(ae,{label:"Hủy bỏ giao dịch này",children:e.jsx(T,{onClick:()=>ye(c.id),children:e.jsx(In,{color:"erorr"})})})," "]})]},d))})]})})}),e.jsx(i,{item:!0,xs:12,sx:{textAlign:"right"},children:e.jsx(T,{onClick:()=>z(!0),disabled:G>0,children:"Thanh toán"})})]})})}),e.jsxs(Q,{open:k,onClose:()=>_(!1),children:[e.jsx(J,{children:"Xác nhận"}),e.jsxs(Z,{children:["Bạn có chắc chắn muốn thanh toán bằng ",P==="cash"?"Tiền mặt":"Chuyển khoản"," không?"]}),e.jsxs(i,{item:!0,xs:12,sx:{textAlign:"right"},children:[e.jsx(T,{onClick:()=>_(!1),children:"Hủy"}),e.jsx(T,{onClick:oe,color:"primary",children:"OK"})]})]})]}),e.jsxs(Q,{open:O,onClose:()=>z(!1),children:[e.jsx(J,{children:"Xác nhận thanh toán"}),e.jsxs(Z,{children:["Bạn có chắc chắn muốn thanh toán bằng hóa đơn ",e.jsxs("strong",{children:[o.ma," "]})," không?"]}),e.jsxs(i,{item:!0,xs:12,sx:{textAlign:"right"},children:[e.jsx(T,{onClick:()=>z(!1),children:"Hủy"}),e.jsx(T,{onClick:U,color:"primary",children:"OK"})]})]}),e.jsxs(Q,{open:W,onClose:()=>{g(!1),localStorage.setItem("billCode","")},children:[e.jsx(J,{children:"Xác nhận in hóa đơn"}),e.jsx(Z,{children:"Bạn có muốn in hóa đơn không "}),e.jsxs(i,{item:!0,xs:12,sx:{textAlign:"right"},children:[e.jsx(T,{onClick:()=>{g(!1),localStorage.setItem("billCode",""),f()},children:"Hủy"}),e.jsx(T,{onClick:()=>{g(!1),fe()},color:"primary",children:"OK"})]})]}),e.jsx(Q,{open:se,onClose:()=>{ge(!1)},children:e.jsx("img",{src:Gn,alt:""})}),Y&&e.jsx("iframe",{ref:s,src:Y,width:"0",height:"0",style:{display:"none"},title:"PDF"}),e.jsx(ue,{open:p,autoHideDuration:6e3,onClose:me,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(de,{onClose:me,severity:h,sx:{width:"100%"},children:ne})})]})};function Xn(C){const{id:x}=Ce(),{bill:s,onLoading:y,onReload:D}=C,o=n.useRef(null),[f,H]=n.useState(!1),[L,P]=n.useState([]),[N,F]=n.useState([]),[I,G]=n.useState([]),[v,w]=n.useState(""),[V,k]=n.useState(""),[_,u]=n.useState(""),[X,O]=n.useState(!1),[z,R]=n.useState(""),[q,W]=n.useState("success"),[g,p]=n.useState(!1),[M,ne]=n.useState(!1),[E,h]=n.useState(!1),[l,se]=n.useState(null),[ge,Y]=n.useState(!1),xe=n.useRef(),[t,A]=n.useState({ten:"",tenKhachHang:"",sdt:"",email:"",diaChi:"",tinh:"",tenTinh:"",huyen:"",tenHuyen:"",phuong:"",tenPhuong:"",ghiChu:"",tienShip:"",loaiHoaDon:"",thanhToanSau:""}),[B,oe]=n.useState({ten:"",sdt:"",email:"",tinh:"",huyen:"",phuong:""});n.useEffect(()=>{A({...s,ten:s.tenKhachHang||"",email:s.email||"",sdt:s.sdt||"",diaChi:s.diaChi||""}),oe({}),H(s.loaiHoaDon==1),pe()},[x,s]);const pe=async()=>{const a=await Sn();if(P(a.data),s!=null&&s.tinh){const r=await He(s.tinh);F(r.data),k(""),u(""),G([])}if(s!=null&&s.huyen){const r=await Ie(s.huyen);G(r.data),u("")}if(s!=null&&s.tinh){const r=L.find(j=>j.ProvinceID===parseInt(s.tinh));if(A(j=>({...j,tinh:s.tinh,tenTinh:r?r.ProvinceName:""})),s!=null&&s.huyen){const j=N.find(S=>S.DistrictID===parseInt(s.huyen));if(A(S=>({...S,huyen:s.huyen,tenHuyen:j?j.DistrictName:""})),(s==null?void 0:s.phuong)!=null){u(s.phuong);const S=I.find(K=>K.WardCode===s.phuong);A(K=>({...K,phuong:s.phuong,tenPhuong:S?S.WardName:""})),fe(s.huyen,s.phuong)}}}},me=async a=>{U(a);const r=a.target.value;w(r);const j=L.find(K=>K.ProvinceID===parseInt(r));A(K=>({...K,tinh:r,tenTinh:j?j.ProvinceName:"",phuong:"",huyen:""}));const S=await He(r);F(S.data),k(""),u(""),G([])},re=async a=>{U(a);const r=a.target.value;k(r);const j=N.find(K=>K.DistrictID===parseInt(r));A(K=>({...K,huyen:r,tenHuyen:j?j.DistrictName:""}));const S=await Ie(r);G(S.data),u("")},ye=a=>{U(a);const r=a.target.value;u(r);const j=I.find(S=>S.WardCode===r);A(S=>({...S,phuong:r,tenPhuong:j?j.WardName:""})),fe(V,r)},fe=async(a,r)=>{console.log("to_district_id",a),console.log("to_ward_code",r);const j=await Tn(a,r),S=await bn(a,r),Ye=new Date(j.data.leadtime*1e3).toISOString().slice(0,19).replace("T"," ");A(Je=>({...Je,tienShip:S.data.total,ngayNhanHangDuKien:Ye}))},je=()=>{p(!1)},U=a=>{const{id:r,value:j}=a.target;A(S=>({...S,[r]:j}))},Se=a=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND",minimumFractionDigits:0}).format(a),Te=a=>{a.preventDefault();const j=new FormData(a.target).get("maPGG");c(j.trim())},c=async a=>{try{const r=await dn(a,x);r.status_code===201&&r.status_code===201&&(R("Thêm phiêu giảm giá vào hóa đơn thành công"),W("success"),p(!0),y(),o.current&&(o.current.value=""))}catch(r){R(r.response.data.message),W("error"),p(!0)}},d=a=>{a.target,H(a.target.checked),pe(),A({...t,loaiHoaDon:a.target.checked?1:0})},$=a=>{A(r=>({...r,thanhToanSau:a.target.checked?1:0}))},ie=a=>{O(!0)},Xe=()=>{O(!1)},Ke=()=>{const a={};if(f&&(t.ten?t.ten.length<5&&(a.ten="Tên phải có ít nhất 5 ký tự"):a.ten="Vui lòng nhập tên của bạn",t.sdt?/^0\d{9}$/.test(t.sdt)||(a.sdt="Số điện thoại không hợp lệ"):a.sdt="Vui lòng nhập số điện thoại",t.email?/^[\w-.]+@([\w-]+\.)+[\w-]{2,4}$/.test(t.email)||(a.email="Email không hợp lệ"):a.email="Vui lòng nhập email",t.tinh||(a.tinh="Vui lòng chọn Tỉnh/Thành Phố"),t.huyen||(a.huyen="Vui lòng chọn Quận/Huyện"),t.phuong||(a.phuong="Vui lòng chọn Phường/Xã")),console.log("Form Data Oke : ",t),oe(a),Object.keys(a).length>0){R("Thông tin đơn hàng chưa cung cấp đủ"),W("error"),p(!0);return}else oe({});if(s.tongSanPham===0){R("Hóa đơn chưa có sản phẩm nào"),W("error"),p(!0);return}t.thanhToanSau==0?ne(!0):h(!0)},Ve=()=>{const a={thanhToanSau:t.thanhToanSau,loaiHoaDon:t.loaiHoaDon,ten:t.ten,sdt:t.sdt,email:t.email,diaChi:t.diaChi,tinh:t.tinh,tenTinh:t.tenTinh,huyen:t.huyen,tenHuyen:t.tenHuyen,phuong:t.phuong,tenPhuong:t.tenPhuong,ghiChu:t.ghiChu,tienShip:t.tienShip};console.log("THANH TOÁN SAU : ",a),Ue(a)},ze=()=>{ne(!1)},Ue=async a=>{try{const r=await Fe(x,a);r.status_code===201&&(R("Xác nhận đắt hàng thành công thành công"),W("success"),p(!0),A({}),H(!1),h(!1),localStorage.setItem("billCode",r.data),Y(!0),D(),y())}catch(r){console.log(r),r.response&&r.response.data&&r.response.data.error?R(r.response.data.error):R("Đã xảy ra lỗi. Vui lòng thử lại."),W("error"),p(!0)}},$e=async a=>{try{const r=await fetch(`http://localhost:8080/api/bills/order-pdf/${a}`,{method:"GET",headers:{"Content-Type":"application/pdf"}});if(r.ok){const j=await r.blob(),S=URL.createObjectURL(j);se(S),R("Xuất hóa đơn thành công"),W("success"),p(!0),setTimeout(()=>{xe.current.contentWindow.print()},500)}else console.error("Failed to fetch PDF")}catch(r){console.error("Error fetching PDF:",r)}finally{localStorage.setItem("billCode",""),p(!0)}},Qe=()=>{const a=localStorage.getItem("billCode");$e(a),Y(!1)},qe=()=>{D()};return console.log("BILL : ",s),e.jsxs(e.Fragment,{children:[e.jsxs(i,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",marginTop:1,borderRadius:2},children:[e.jsx(i,{item:!0,xs:8,children:e.jsx(b,{variant:"h3",children:"Thông tin đơn hàng "})}),e.jsx(i,{item:!0,xs:4}),e.jsx(i,{mt:2,item:!0,xs:12,sx:{borderTop:1}}),e.jsx(i,{item:!0,xs:8,children:f&&x?e.jsxs(i,{container:!0,spacing:2,children:[e.jsx(i,{item:!0,xs:12,sm:4,children:e.jsx(ee,{label:"Tên của bạn",id:"ten",placeholder:"Nhập tên của bạn",value:t.ten||"",onChange:U,error:!!B.ten,helperText:B.ten,fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!!t.ten}})}),e.jsx(i,{item:!0,xs:12,sm:4,children:e.jsx(ee,{label:"Số điện thoại",id:"sdt",placeholder:"Nhập số điện thoại",value:t.sdt,onChange:U,error:!!B.sdt,helperText:B.sdt,fullWidth:!0,margin:"normal",type:"tel",InputLabelProps:{shrink:!!t.sdt}})}),e.jsx(i,{item:!0,xs:12,sm:4,children:e.jsx(ee,{label:"Email",id:"email",placeholder:"Nhập email",value:t.email,onChange:U,error:!!B.email,helperText:B.email,fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!!t.email}})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(ee,{label:"Địa chỉ giao hàng",id:"diaChi",placeholder:"Nhập địa chỉ giao hàng",value:t.diaChi,onChange:U,fullWidth:!0,margin:"normal",multiline:!0,rows:4,InputLabelProps:{shrink:!!t.diaChi}})}),e.jsx(i,{item:!0,xs:12,sm:4,children:e.jsxs(be,{fullWidth:!0,margin:"normal",children:[e.jsx(ve,{id:"tinh-label",children:"Tỉnh/Thành Phố"}),e.jsxs(ke,{labelId:"tinh-label",id:"tinh",value:t.tinh,onChange:me,error:!!B.tinh,children:[e.jsx(te,{value:"",disabled:!0,children:"Chọn Tỉnh/Thành Phố"}),L.map(a=>e.jsx(te,{value:a.ProvinceID,children:a.ProvinceName},a.ProvinceID))]}),B.tinh&&e.jsx(b,{color:"error",children:B.tinh})]})}),e.jsx(i,{item:!0,xs:12,sm:4,children:e.jsxs(be,{fullWidth:!0,margin:"normal",children:[e.jsx(ve,{id:"huyen-label",children:"Quận/Huyện"}),e.jsxs(ke,{labelId:"huyen-label",id:"huyen",value:t.huyen,onChange:re,children:[e.jsx(te,{value:"",children:"Chọn Quận/Huyện"}),N.map(a=>e.jsx(te,{value:a.DistrictID,children:a.DistrictName},a.DistrictID))]}),B.huyen&&e.jsx(b,{color:"error",children:B.huyen})]})}),e.jsx(i,{item:!0,xs:12,sm:4,children:e.jsxs(be,{fullWidth:!0,margin:"normal",children:[e.jsx(ve,{id:"phuong-label",children:"Phường/Xã"}),e.jsxs(ke,{labelId:"phuong-label",id:"phuong",value:t.phuong,onChange:ye,children:[e.jsx(te,{value:"",children:"Chọn Phường/Xã"}),I.map(a=>e.jsx(te,{value:a.WardCode,children:a.WardName},a.WardCode))]}),B.phuong&&e.jsx(b,{color:"error",children:B.phuong})]})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(ee,{label:"Ghi chú",id:"ghiChu",placeholder:"Ghi chú",value:t.ghiChu,onChange:U,fullWidth:!0,margin:"normal",multiline:!0,rows:4,InputLabelProps:{shrink:!!t.ghiChu}})}),e.jsx(i,{item:!0,xs:12,style:{display:"flex",flexDirection:"column",alignItems:"center"},children:e.jsxs("strong",{style:{fontSize:"24px"},children:[" Phí ship : ",Se(t.tienShip)]})})]}):e.jsx(e.Fragment,{})}),e.jsxs(i,{item:!0,xs:4,children:[e.jsxs(Ln,{display:"flex",alignItems:"center",sx:{flexDirection:{xs:"column",sm:"row"}},children:[e.jsx(T,{variant:"contained",color:"warning",size:"small",sx:{padding:1,borderRadius:3,mr:2},onClick:()=>{ie()},disabled:!x,children:"Chọn Mã Giảm Giá :"}),e.jsx("form",{onSubmit:Te,children:e.jsx("input",{type:"text",placeholder:"Mã Giảm Giá",name:"maPGG",style:{width:"150%",padding:"10px",border:"1px solid #ccc",borderRadius:"4px"},ref:o})})," "]}),e.jsx(Be,{disabled:!x,control:e.jsx(Le,{checked:f,onChange:d,color:"primary"}),label:f?"Giao hàng":"Tại quầy"}),f&&e.jsx(Be,{control:e.jsx(Le,{checked:(t==null?void 0:t.thanhToanSau)===1,onChange:$,color:"primary"}),label:"Trả sau"}),e.jsxs(b,{mt:1,variant:"h4",children:["Tạm tính: ",x?parseFloat((t==null?void 0:t.tongTienBanDau)||0).toLocaleString()||"0":0," đ"]}),e.jsxs(b,{mt:1,variant:"h4",children:["Mã Voucher : ",x&&(t==null?void 0:t.maPGG)||""]}),e.jsxs(b,{mt:1,variant:"h4",children:["Voucher: - ",x&&parseFloat((t==null?void 0:t.giaTriPhieuGiamGia)||0).toLocaleString()||"0"," đ"]}),e.jsxs(b,{mt:1,variant:"h4",fontWeight:"bold",color:"error",children:["Tiền sau giảm giá: ",x&&parseFloat((t==null?void 0:t.tongTienPhaiTra)||0).toLocaleString()||"0"," đ"]}),f&&e.jsxs(b,{mt:1,variant:"h4",children:["Tiền ship: + ",x&&parseFloat((t==null?void 0:t.tienShip)||0).toLocaleString()||"0"," đ"]}),e.jsxs(b,{mt:1,variant:"h4",fontWeight:"bold",color:"error",children:["Tổng hóa đơn :"," ",x&&parseFloat((t==null?void 0:t.tongTienPhaiTra)+(f?t.tienShip:0)||0).toLocaleString()||"0"," VNĐ"]}),e.jsx(T,{variant:"contained",color:"primary",onClick:Ke,disabled:!x,children:t.thanhToanSau==1?"Xác nhận đặt hàng":"Tiến hành thanh toán"}),e.jsx(_n,{open:M,onCloseDialog:ze,data:t,onReload:qe})]})]}),e.jsx(vn,{showDiaLogCoupon:X,handleCloseDiaLogCoupon:Xe,bill:s,onLoading:()=>{y()}}),e.jsxs(Q,{open:E,onClose:()=>h(!1),children:[e.jsx(J,{children:"Xác nhận thanh toán"}),e.jsxs(Z,{children:["Bạn chắc chắn muốn thanh toán hóa đơn ",e.jsxs("strong",{children:[s.ma," "]})," trả sau không?"]}),e.jsxs(i,{item:!0,xs:12,sx:{textAlign:"right"},children:[e.jsx(T,{onClick:()=>h(!1),children:"Hủy"}),e.jsx(T,{onClick:Ve,color:"primary",children:"OK"})]})]}),e.jsx(ue,{open:g,autoHideDuration:2e3,onClose:je,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(de,{onClose:je,severity:q,sx:{width:"100%"},children:z})}),e.jsxs(Q,{open:ge,onClose:()=>{Y(!1),localStorage.setItem("billCode","")},children:[e.jsx(J,{children:"Xác nhận in hóa đơn"}),e.jsx(Z,{children:"Bạn có muốn in hóa đơn không "}),e.jsxs(i,{item:!0,xs:12,sx:{textAlign:"right"},children:[e.jsx(T,{onClick:()=>{Y(!1),localStorage.setItem("billCode","")},children:"Hủy"}),e.jsx(T,{onClick:()=>{Y(!1),Qe()},color:"primary",children:"OK"})]})]}),l&&e.jsx("iframe",{ref:xe,src:l,width:"0",height:"0",style:{display:"none"},title:"PDF"})]})}const Kn=async()=>{try{return await pn("sell/bill-codes")}catch(C){throw console.error("Error fetching sell get bill codes:",C),C}};function Vn(C){const{id:x}=Ce(),{bill:s,onLoading:y}=C,[D,o]=n.useState([]),[f,H]=n.useState(!1),[L,P]=n.useState(1),[N,F]=n.useState(0),[I,G]=n.useState(""),[v,w]=n.useState({ten:"",sdt:"",email:"",diaChi:""}),[V,k]=n.useState(""),[_,u]=n.useState("success"),[X,O]=n.useState(!1),z=()=>{O(!1)};n.useEffect(()=>{w(x?{ten:s.tenKhachHang,sdt:s.sdt||"",email:s.email,diaChi:s.diaChi}:{ten:"",sdt:"",email:"",diaChi:""})},[x,s]),console.log("bill",s),console.log("setCustomer ",v);const R=async h=>{try{const l=await Dn(I,h-1);l&&(o(l.content),F(l.totalPages))}catch{k("Api khách hàng lỗi"),u("error"),O(!0)}},q=h=>{const{value:l}=h.target;G(l.trim()),R(L)},W=async h=>{try{const l=await un(h,x);l.status_code&&(k("Thêm khách hàng thành công"),u("success"),O(!0),console.log("DATA IN CUSMTOM  :",l.data),w({ten:l.data.tenKhachHang,sdt:l.data.sdt,email:l.data.email,diaChi:l.data.diaChi}),y(),E())}catch{k("Thêm khách hàng thất bại"),u("error"),O(!0)}},g=async h=>{try{const l=await Pn(h);l?(k("Thêm khách hàng thành công"),u("success"),O(!0),W(l.data.id,x),w({ten:l.data.ten,sdt:l.data.sdt,email:l.data.email})):(k("Khoong thể thêm"),u("error"),O(!0))}catch(l){console.log(l),k(l.response.data.message),u("error"),O(!0)}},p=h=>{h.preventDefault();const se=new FormData(h.target).get("sdt");g(se.trim())},M=h=>{P(h),R(h)},ne=h=>{H(!0),R(L)},E=()=>{H(!1),o([])};return e.jsxs(e.Fragment,{children:[e.jsxs(i,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",marginTop:1,borderRadius:2},children:[e.jsxs(i,{container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsx(b,{variant:"h3",children:"Khách hàng"}),e.jsx(T,{variant:"contained",color:"primary",onClick:()=>{ne()},disabled:!x,children:"Chọn khách hàng"})]}),e.jsxs(i,{container:!0,spacing:2,paddingY:2,borderBottom:1,borderColor:"grey.300",children:[e.jsx(i,{item:!0,xs:6,children:e.jsxs(b,{variant:"subtitle1",children:["Tên khách hàng : ",v.ten]})}),e.jsx(i,{item:!0,xs:6,children:e.jsxs(b,{variant:"subtitle1",children:["Email : ",v.email]})})]}),e.jsxs(i,{container:!0,spacing:2,paddingY:2,children:[e.jsx(i,{item:!0,xs:6,children:e.jsxs(b,{variant:"subtitle1",sx:{display:"flex",alignItems:"center"},children:["Số điện thoại :",e.jsx("form",{onSubmit:p,style:{width:"70%",marginLeft:"5px"},children:e.jsx(ee,{type:"text",placeholder:"Số điện thoại",name:"sdt",value:v.sdt,variant:"outlined",label:"Số điện thoại",InputLabelProps:{shrink:!!v.sdt},onChange:h=>{w({...v,sdt:h.target.value})},fullWidth:!0,margin:"normal"})})]})}),e.jsx(i,{item:!0,xs:6,children:e.jsxs(b,{variant:"subtitle1",children:["Địa chỉ : ",v.diaChi]})})]})]}),e.jsxs(Q,{open:f,onClose:E,maxWidth:"md",fullWidth:!0,children:[e.jsx(J,{children:"Danh sách khách hàng"}),e.jsxs(Z,{children:[e.jsx("input",{type:"text",name:"search",placeholder:"Tìm theo mã , tên , sđt , email",onChange:q,style:{width:"100%",padding:"10px",border:"1px solid #ccc",borderRadius:"4px"}}),e.jsx(Ee,{component:Re,style:{maxHeight:"500px"},children:e.jsxs(De,{stickyHeader:!0,children:[e.jsx(Ge,{children:e.jsxs(he,{children:[e.jsx(m,{}),e.jsx(m,{children:"Họ và tên"}),e.jsx(m,{children:"SDT"}),e.jsx(m,{children:"Email"}),e.jsx(m,{children:"Hành động"})]})}),e.jsx(Pe,{style:{maxHeight:"300px",overflowY:"auto"},children:D.map(h=>e.jsxs(he,{children:[e.jsx(m,{}),e.jsx(m,{children:`${h.ho?h.ho:""} ${h.ten?h.ten:""}`.trim()||"N/A"}),e.jsx(m,{children:h.sdt}),e.jsx(m,{children:h.email?h.email:"N/A"}),e.jsx(m,{children:e.jsx(ae,{title:"Chọn khách hàng này",placement:"top",children:e.jsx(ce,{onClick:()=>{W(h.id)},color:"primary",disabled:(s==null?void 0:s.idKhachHang)===!1||s.idKhachHang===h.id,children:e.jsx(Hn,{})})})})]},h.id))})]})})]}),e.jsx(wn,{sx:{marginTop:"10px",textAlign:"center"},count:N,page:L,onChange:(h,l)=>M(l)}),e.jsx(Me,{children:e.jsx(T,{onClick:E,color:"primary",children:"Đóng"})})]}),e.jsx(ue,{open:X,autoHideDuration:6e3,onClose:z,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(de,{onClose:z,severity:_,sx:{width:"100%"},children:V})})]})}function zn(C){const{onReload:x,bills:s}=C,[y,D]=n.useState(!1),[o,f]=n.useState([]),[H,L]=n.useState(0),[P,N]=n.useState(""),[F,I]=n.useState("success"),[G,v]=n.useState(!1),w=()=>{D(!y)},V=()=>{v(!1)};n.useEffect(()=>{k()},[s]);const k=async()=>{try{const u=await gn();u.status_code===200&&(f(u.data),L(u.data.length))}catch(u){console.log("Lỗi",u)}},_=async u=>{if(s.length>=5){N("Đã đủ 5 hóa đơn không thể chuyển lại được"),I("error"),v(!0);return}try{(await Oe(u,"DON_MOI")).status_code===201&&(N("Hủy treo hóa đơn thành công"),I("success"),k(),x())}catch(X){N("Chuyển đổi trạng thái thất bại"),I("error"),console.log("Lỗi",X)}v(!0)};return e.jsxs(e.Fragment,{children:[e.jsx(ae,{title:"Hóa đơn treo",placement:"top",children:e.jsx(Nn,{component:"div",onClick:w,size:"medium",variant:"circular",color:"secondary",sx:{borderRadius:0,borderTopLeftRadius:"50%",borderBottomLeftRadius:"50%",borderTopRightRadius:"50%",borderBottomRightRadius:"4px",top:"12%",position:"fixed",right:10},children:e.jsx(Bn,{badgeContent:H,color:"error",overlap:"circular",children:e.jsx(ce,{color:"inherit",size:"large",disableRipple:!0,children:e.jsx(Fn,{})})})})}),e.jsx(an,{anchor:"right",onClose:w,open:y,PaperProps:{sx:{width:280}},children:e.jsx(sn,{component:"div",children:e.jsx(i,{container:!0,spacing:on,sx:{p:1},children:e.jsx(i,{item:!0,xs:12,children:e.jsx(rn,{title:"Danh sách hóa đơn treo",children:e.jsx(De,{children:e.jsx(Pe,{children:o.map(u=>e.jsxs(he,{children:[e.jsx(m,{align:"center",sx:{width:"10%"},children:e.jsx(ae,{title:"Chuyển về bán hàng",placement:"top",children:e.jsx(ce,{onClick:()=>{_(u)},children:e.jsx(On,{})})})}),e.jsx(m,{align:"left",sx:{width:"90%"},children:e.jsx(ln,{label:u,color:"warning",sx:{fontWeight:"bold",width:"100%"}})})]},u))})})})})})})}),e.jsx(ue,{open:G,autoHideDuration:2e3,onClose:V,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(de,{onClose:V,severity:F,sx:{width:"100%"},children:P})})]})}function Un(C){const{onReload:x,exitingBill:s}=C,{id:y}=Ce();Ae();const[D,o]=n.useState({}),f=async()=>{try{const P=await We(y);P.status_code===200&&o(P.data)}catch(P){console.log("Lỗi : ",P)}};n.useEffect(()=>{f()},[y]);const H=()=>{f()},L=()=>{o({}),x(),console.log("Gọi hàm nay")};return e.jsxs(e.Fragment,{children:[e.jsx(kn,{onLoading:H,bill:D,title:"Giỏ hàng"}),e.jsx(Vn,{onLoading:H,bill:D}),e.jsx(Xn,{onLoading:H,bill:D,onReload:L})]})}function It(){const C=Ae(),[x,s]=n.useState({}),[y,D]=n.useState([]),[o,f]=n.useState(null);n.useState(!1);const[H,L]=n.useState(""),[P,N]=n.useState(""),[F,I]=n.useState("success"),[G,v]=n.useState(!1),[w,V]=n.useState(!1),k=()=>{v(!1)},_=g=>{V(!0),L(g)},u=()=>{V(!1)},X=async()=>{const g=await Kn();g.status_code===200&&(g.data.length>0?(D(g.data),f(0),C(`/ban-hang/hoa-don/${g.data[0]}`)):(D([]),f(null),C("/ban-hang")))};n.useEffect(()=>{X()},[]);const O=async g=>{try{const p=await We(g);p.status_code===200&&(s(p.data),console.log("CAlll APi"))}catch{s({}),C("/ban-hang")}},z=(g,p)=>{f(p),C(`/ban-hang/hoa-don/${y[p]}`),console.log("Code : ",y[p]),y[p]&&O(y[p])},R=async()=>{if(y.length>=5){N("Chỉ được phép tạo 5 hóa đơn . Bạn hãy treo 1 hóa đơn để tạo mới"),I("success"),v(!0),C("/ban-hang");return}const g=await xn();g.status_code===201&&(D(p=>[g.data.ma,...p]),f(0),C(`/ban-hang/hoa-don/${g.data.ma}`),mn.success(fn.CREATED))},q=()=>{X(),C("/ban-hang")},W=async()=>{try{(await Oe(H,"TREO")).status_code===201&&(N("Hủy treo hóa đơn thành công"),I("success"),X())}catch(g){N("Chuyển đổi trạng thái thất bại"),I("error"),console.log("Lỗi",g)}finally{v(!0),u()}};return e.jsxs(e.Fragment,{children:[e.jsxs(le,{children:[e.jsx(le,{sx:{borderBottom:1,borderColor:"divider",marginTop:2},children:e.jsxs(Rn,{value:o,onChange:z,variant:"scrollable",scrollButtons:"auto",children:[y.map((g,p)=>e.jsx(Ne,{label:e.jsxs(le,{sx:{display:"flex",alignItems:"center"},children:[g,e.jsx(ae,{title:"Treo hóa đơn này",placement:"top",children:e.jsx(ce,{onClick:()=>{_(g)},children:e.jsx(hn,{fontSize:"small"})})})]})},g)),e.jsx(Ne,{label:e.jsx(le,{sx:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",padding:"10px",height:"30px",width:"30px",border:"2px solid #697586"},children:e.jsx(cn,{onClick:()=>R(),sx:{fontSize:30}})})})]})})," ",e.jsx(Un,{exitingBill:x,onReload:q})]}),e.jsx(zn,{onReload:q,bills:y}),e.jsxs(Q,{open:w,onClose:u,children:[e.jsx(J,{children:"Xác nhận"}),e.jsx(Z,{children:e.jsx(An,{children:"Bạn có chắc chắn muốn thực hiện hành động này?"})}),e.jsxs(Me,{children:[e.jsx(T,{onClick:u,color:"primary",children:"Hủy"}),e.jsx(T,{onClick:W,color:"primary",children:"Xác nhận"})]})]}),e.jsx(ue,{open:G,autoHideDuration:2e3,onClose:k,anchorOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(de,{onClose:k,severity:F,sx:{width:"100%"},children:P})})]})}export{It as default};
