import{r as i,j as t,M as v,Z as y,I as N,ab as d}from"./index-ODiMIL8c.js";import{r as je,u as L}from"./xlsx-ChUIJHMt.js";import{c as ve}from"./sanPham-CD8W00Ub.js";import{B as c}from"./react-toastify.esm-7DHR6V1D.js";import{c as Pe}from"./chiTietSanPham-BT06cGXG.js";import{U as Te}from"./Upload-CEfuQGxz.js";import{D as b,a as D}from"./DataGrid-C7msUJw3.js";import"./back-end-vuWvP0DO.js";import"./toPropertyKey-PLuKRk1e.js";import"./Autocomplete-DcWqKeDV.js";import"./Close-BVp8FVaf.js";import"./MenuItem-9SXJ4cuB.js";import"./Checkbox-CZLLfLAq.js";import"./CircularProgress-CYg-8QUw.js";import"./TablePagination-DjnFoDqb.js";import"./KeyboardArrowRight-DRQYp2Cc.js";import"./LastPage-BI26Cmhz.js";import"./TableCell-CvT0UNUt.js";import"./useThemeProps-BfmIH54n.js";const qe=()=>{const R=[{field:"index",headerName:"STT",width:70,flex:1,renderCell:e=>t.jsx("div",{children:e.id+1})},{field:"ten",headerName:"Tên Sản Phẩm",width:130,flex:1},{field:"moTa",headerName:"Mô Tả",width:130,flex:1},{field:"nhuCau",headerName:"Nhu Cầu",width:130,flex:1},{field:"thuongHieu",headerName:"Thương Hiệu",width:130,flex:1},{field:"actions",headerName:"Thao Tác",sortable:!1,width:160,flex:1,renderCell:e=>t.jsxs("div",{children:[t.jsx("div",{style:{display:"inline-block"}}),t.jsx(N,{color:"error",onClick:()=>handleDelete(e.id),children:t.jsx(D,{})})]})}],k=[{field:"stt",headerName:"STT",width:70,flex:1,renderCell:e=>t.jsx("div",{children:e.id+1})},{field:"sanPhamInfo",headerName:"Tên Sản Phẩm",width:130,flex:1,renderCell:e=>t.jsx("div",{children:e.row.sanPhamInfo.ten})},{field:"banPhimInfo",headerName:"Bàn Phím",width:130,flex:1,renderCell:e=>t.jsx("div",{children:e.row.banPhimInfo.ten})},{field:"cpuInfo",headerName:"CPU",width:130,flex:1,renderCell:e=>t.jsx("div",{children:e.row.cpuInfo.ten})},{field:"heDieuHanhInfo",headerName:"Hệ Điều Hành",width:130,flex:1,renderCell:e=>t.jsx("div",{children:e.row.heDieuHanhInfo.ten})},{field:"manHinhInfo",headerName:"Màn Hình",width:130,flex:1,renderCell:e=>t.jsx("div",{children:e.row.manHinhInfo.ten})},{field:"ramInfo",headerName:"RAM",width:130,flex:1,renderCell:e=>t.jsx("div",{children:e.row.ramInfo.ten})},{field:"vgaInfo",headerName:"VGA",width:130,flex:1,renderCell:e=>t.jsx("div",{children:e.row.vgaInfo.ten})},{field:"oCungInfo",headerName:"Ổ Cứng",width:130,flex:1,renderCell:e=>t.jsx("div",{children:e.row.oCungInfo.ten})},{field:"webcamInfo",headerName:"Webcam",width:130,flex:1,renderCell:e=>t.jsx("div",{children:e.row.webcamInfo.ten})},{field:"mauSacInfo",headerName:"Màu Sắc",width:130,flex:1,renderCell:e=>t.jsx("div",{children:e.row.mauSacInfo.ten})},{field:"giaBan",headerName:"Giá Bán",width:130,flex:1,renderCell:e=>t.jsx("div",{children:e.row.giaBan})},{field:"actions",headerName:"Thao Tác",sortable:!1,width:160,flex:1,renderCell:e=>t.jsxs("div",{children:[t.jsx("div",{style:{display:"inline-block"}}),t.jsx(N,{color:"error",onClick:()=>handleDelete(e.id),children:t.jsx(D,{})})]})}],x=i.useRef(null),[P,M]=i.useState([]),[T,$]=i.useState([]),[A,O]=i.useState(!1),[U,z]=i.useState([]),[E,G]=i.useState([]),[V,_]=i.useState([]),[F,W]=i.useState([]),[q,J]=i.useState([]),[X,Z]=i.useState([]),[K,Q]=i.useState([]),[Y,ee]=i.useState([]),[te,ae]=i.useState([]),[ne,se]=i.useState([]),[oe,ie]=i.useState([]);i.useState([{id:1,ten:"Hoạt động"},{id:0,ten:"Đã tắt"}]);const re=()=>{x.current.click()},le=e=>{const h=e.target.files[0],r=new FileReader;r.onload=l=>{const u=new Uint8Array(l.target.result),m=je(u,{type:"array"}),p=m.SheetNames[0],a=m.Sheets[p],f=L.sheet_to_json(a).map((n,w)=>{const S=ne.find(g=>g.ten.toLowerCase()===n.nhuCau.toLowerCase()),j=oe.find(g=>g.ten.toLowerCase()===n.thuongHieu.toLowerCase());return{...n,id:w,nhuCauInfo:S,thuongHieuInfo:j}}),C=H(f.map(n=>({...n,id:0})));if(C.length>0){const n=C.map(w=>w.ten);c.error(`Dữ liệu bị lặp lại ở sản phẩm: ${n.join(", ")}`);return}const ue=m.SheetNames[1],fe=m.Sheets[ue],I=L.sheet_to_json(fe).map((n,w)=>{const S=te.find(s=>s.ten.toLowerCase()===n.tenBanPhim.toLowerCase()),j=V.find(s=>s.ten.toLowerCase()===n.tenCPU.toLowerCase()),g=Y.find(s=>s.ten.toLowerCase()===n.tenHeDieuHanh.toLowerCase()),me=K.find(s=>s.ten.toLowerCase()===n.tenManHinh.toLowerCase()),pe=E.find(s=>s.ten.toLowerCase()===n.tenMauSac.toLowerCase()),we=U.find(s=>s.ten.toLowerCase()===n.tenRam.toLowerCase()),ge=F.find(s=>s.ten.toLowerCase()===n.tenVGA.toLowerCase()),Ce=q.find(s=>s.ten.toLowerCase()===n.tenWebcam.toLowerCase()),xe=X.find(s=>s.ten.toLowerCase()===n.tenOCung.toLowerCase()),Ie=f.find(s=>s.ten.toLowerCase()===n.tenSanPham.toLowerCase()),Se=n.giaBan;return{id:w,banPhimInfo:S,cpuInfo:j,heDieuHanhInfo:g,manHinhInfo:me,mauSacInfo:pe,ramInfo:we,vgaInfo:ge,webcamInfo:Ce,oCungInfo:xe,sanPhamInfo:Ie,giaBan:Se,tenSanPham:n.tenSanPham}});for(const n of I)if(!(n!=null&&n.sanPhamInfo)){c.error(`Tên sản phẩm "${n.tenSanPham}" ở mục BIẾN THỂ không khớp`);return}const B=H(I.map(n=>({...n,id:0})));if(B.length>0){const n=B.map(w=>w.sanPhamInfo.ten);c.error(`Dữ liệu bị lặp lại ở biến thể có tên sản phẩm là: ${n.join(", ")}`);return}M(f),$(I),O(!0)},x.current.value=null,r.readAsArrayBuffer(h)},he=async()=>{const e=await d.get("http://localhost:8080/api/nhu-cau/all-list-active"),h=await d.get("http://localhost:8080/api/thuong-hieu/all-list-active"),r=await d.get("http://localhost:8080/api/ram/all-list-active"),l=await d.get("http://localhost:8080/api/mau-sac/all-list-active"),u=await d.get("http://localhost:8080/api/cpu/all-list-active"),m=await d.get("http://localhost:8080/api/vga/all-list-active"),p=await d.get("http://localhost:8080/api/webcam/all-list-active"),a=await d.get("http://localhost:8080/api/o-cung/all-list-active"),o=await d.get("http://localhost:8080/api/man-hinh/all-list-active"),f=await d.get("http://localhost:8080/api/he-dieu-hanh/all-list-active"),C=await d.get("http://localhost:8080/api/ban-phim/all-list-active");se(e.data.data),ie(h.data.data),z(r.data.data),G(l.data.data),_(u.data.data),W(m.data.data),J(p.data.data),Z(a.data.data),Q(o.data.data),ee(f.data.data),ae(C.data.data)},de=async()=>{const e=P.map(a=>ve({moTa:a.moTa,nhuCauId:a.nhuCauInfo.id,ten:a.ten,thuongHieuId:a.thuongHieuInfo.id,trangThai:1})),h=await Promise.allSettled(e);let r=[],l=[];const u=[];h.forEach((a,o)=>{if(a.status==="fulfilled"){const f=a.value;f?(l.push(o+1),u.push(f),o===h.length-1&&c.success(`Sản phẩm thứ ${l.join(", ")} đã thêm thành công`)):(r.push(o+1),o===h.length-1&&c.error(`Sản phẩm thứ ${r.join(", ")} đã tồn tại`))}else a.status==="rejected"&&c.error(`Thêm sản phẩm thứ ${o+1} thất bại: ${a.reason.message||a.reason}`)});const m=T.map(a=>{for(const o of u)if(o.ten===a.sanPhamInfo.ten)return Pe({banPhimId:a.banPhimInfo.id,cpuId:a.cpuInfo.id,heDieuHanhId:a.heDieuHanhInfo.id,manHinhId:a.manHinhInfo.id,mauSacId:a.mauSacInfo.id,ocungId:a.oCungInfo.id,ramId:a.ramInfo.id,sanPhamId:o.id,vgaId:a.vgaInfo.id,webcamId:a.webcamInfo.id,giaBan:a.giaBan,trangThai:1})});r=[],l=[];const p=await Promise.allSettled(m);return p.forEach((a,o)=>{a.status==="fulfilled"?a.value?(l.push(o+1),o===p.length-1&&c.success(`Biến thể thứ ${l.join(", ")} đã thêm thành công`)):(r.push(o+1),o===h.length-1&&c.error(`Biến thể thứ ${r.join(", ")} đã tồn tại`)):a.status==="rejected"&&c.error(`Thêm Biến thể thứ ${o+1} thất bại: ${a.reason.message||a.reason}`)}),p},ce=async()=>{await c.promise(de(),{pending:"Đang thêm sản phẩm...",error:"Có lỗi xảy ra, vui lòng thử lại 🤯"})},H=e=>{const h=[],r=new Set;return e.forEach(l=>{const u=JSON.stringify(l);r.has(u)?h.push(l):r.add(u)}),h};return i.useEffect(()=>{he()},[]),t.jsxs("div",{children:[t.jsx("div",{children:t.jsx(v,{title:"Import Sản phẩm của bạn",children:t.jsx("div",{style:{display:"flex",justifyContent:"center"},children:t.jsxs(y,{size:"medium",onClick:re,style:{background:"#673ab7",color:"#fff",padding:"5px 20px"},children:["Tải lên ",t.jsx(Te,{}),t.jsx("input",{hidden:!0,type:"file",accept:".xlsx, .xls",ref:x,onInput:e=>le(e)})]})})})}),A&&t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx(v,{title:"Danh Sách Sản Phẩm",children:t.jsx("div",{style:{height:400,width:"100%"},children:t.jsx(b,{rows:P,columns:R,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,20]})})}),t.jsx(v,{title:"Danh Sách Biến Thể",style:{marginTop:"20px"},children:t.jsx("div",{style:{height:400,width:"100%"},children:t.jsx(b,{rows:T,columns:k,initialState:{pagination:{paginationModel:{pageSize:5}}},pageSizeOptions:[5,10,20]})})}),t.jsx("div",{style:{marginTop:"20px",display:"flex",justifyContent:"end",marginRight:"30px"},children:t.jsx(y,{style:{background:"#673ab7",color:"#fff",padding:"5px 20px"},onClick:ce,children:"Xác nhận"})})]})]})};export{qe as default};
