import{a4 as ie,r as a,ab as b,j as t,T as oe,G as n,B as F,N as m,J as y,a5 as le,a6 as ce,a7 as H,a8 as M,L as A,K as w,ad as T,Z as _}from"./index-ODiMIL8c.js";import{u as he,C as o,o as de}from"./yup-Dd8QXFHT.js";import{c as ue,a as v,d as me,b as ge}from"./index.esm-gNzFFELg.js";import{L as xe,A as pe}from"./AdapterMoment-y0b4xXJh.js";import{M as g}from"./MenuItem-9SXJ4cuB.js";import{C as fe}from"./CircularProgress-CYg-8QUw.js";import{S as je,A as be}from"./Snackbar-cwqFnrZx.js";import{a as ye,c as ve,b as ke,D as Se}from"./DialogTitle-UPTmzQrS.js";import{D as De}from"./DialogContentText-C6_zaY_q.js";import"./useThemeProps-BfmIH54n.js";import"./moment-G82_0lEo.js";import"./Close-BVp8FVaf.js";const q=ue().shape({ten:v().max(50,"Tên không được vượt quá 50 ký tự").required("Tên không được để trống"),email:v().email("Email không hợp lệ").required("Email không được để trống"),sdt:v().matches(/^\+?[0-9. ()-]{7,25}$/,"Số điện thoại không hợp lệ").required("Số điện thoại không được để trống"),ngay_sinh:me().required("Ngày sinh không được để trống").max(new Date,"Ngày sinh phải là quá khứ hoặc hiện tại").test("age","Khách hàng phải từ 10 tuổi trở lên",x=>{if(!x)return!1;const l=new Date,h=new Date(x);let i=l.getFullYear()-h.getFullYear();const s=l.getMonth()-h.getMonth();return(s<0||s===0&&l.getDate()<h.getDate())&&i--,i>=10}),gioi_tinh:ge().required("Giới tính không được để trống"),hinhAnh:v()});function Ae(){const x=ie(),{register:l,handleSubmit:h,control:i,formState:{errors:s}}=he({resolver:de(q)}),[k,B]=a.useState(""),[O,K]=a.useState([]),[G,R]=a.useState([]),[$,U]=a.useState([]),[d,X]=a.useState(""),[u,z]=a.useState(""),[P,Q]=a.useState(""),[Y,p]=a.useState(""),[W,J]=a.useState(null),[Z,f]=a.useState(!1),[V,c]=a.useState(""),[ee,S]=a.useState("success");a.useState(!1),a.useEffect(()=>{(async()=>{try{p(!0),await te()}catch{J("Failed to fetch initial data")}finally{p(!1)}})()},[]),a.useEffect(()=>{d&&re(d)},[d]),a.useEffect(()=>{u&&se(u)},[u]),a.useEffect(()=>{var e;const r=Object.keys(s);if(r.length>0){const C=r[0],j=((e=s[C])==null?void 0:e.message)||"Đã xảy ra lỗi";c(j),S("error"),f(!0)}},[s]);const te=async()=>{debugger;try{const r=await b.get("https://online-gateway.ghn.vn/shiip/public-api/master-data/province",{headers:{token:"0292ba75-34b6-11ef-89ca-1aad91406dac"}});K(r.data.data)}catch(r){throw console.error("Error fetching provinces:",r),r}},re=async r=>{debugger;try{const e=await b.get("https://online-gateway.ghn.vn/shiip/public-api/master-data/district",{headers:{token:"0292ba75-34b6-11ef-89ca-1aad91406dac"},params:{province_id:r}});R(e.data.data)}catch(e){throw console.error("Error fetching districts:",e),e}},se=async r=>{debugger;try{const e=await b.get("https://online-gateway.ghn.vn/shiip/public-api/master-data/ward",{headers:{token:"0292ba75-34b6-11ef-89ca-1aad91406dac"},params:{district_id:r}});U(e.data.data)}catch(e){throw console.error("Error fetching wards:",e),e}},E=()=>{window.cloudinary.openUploadWidget({cloudName:"daljc2ktr",uploadPreset:"ovuxjxsx",sources:["local","url","camera","google_photos","facebook","dropbox","instagram"],multiple:!1,cropping:!0,folder:"customers_images"},(r,e)=>{!r&&e.event==="success"&&B(e.info.secure_url)})},I=()=>{f(!1)},ae=()=>{x("/khachhang/danhsachkhachhang")},N=async r=>{L(!0),p(!0);try{debugger;let e={};if(e.ten=r.ten,e.email=r.email,e.sdt=r.sdt,e.ngay_sinh=new Date(r.ngay_sinh).toISOString(),e.gioi_tinh=r.gioi_tinh,e.hinhAnh=k,e.idPhuongXa=P,e.idQuanHuyen=u,e.idTinhThanhPho=d,e.diaChiNhanHang=r.dia_chi,await q.validate(e),(await b({method:"post",url:"http://localhost:8080/api/khachhang/create",data:e,headers:{"Content-Type":"application/json"}})).status===200)c("Dữ liệu khách hàng được thêm thành công!"),S("success"),f(!0),setTimeout(()=>{ae()},3e3);else throw new Error("Unexpected response status")}catch(e){if(e.response&&e.response.data&&e.response.data.message){const j=e.response.data.error.split(":").pop().trim();c(j)}else e.response&&e.response.data&&e.response.data.error?c(e.response.data.error):e.message?c(e.message):c("Có lỗi xảy ra khi xử lý yêu cầu!");S("error"),f(!0)}finally{p(!1)}},[ne,L]=a.useState(!1),D=r=>{L(!1),r&&N()};return t.jsxs(xe,{dateAdapter:pe,children:[t.jsx(oe,{variant:"h1",gutterBottom:!0,style:{textAlign:"center",marginBottom:"5%"},children:"Thêm Khách Hàng"}),t.jsx("form",{onSubmit:h(N),children:t.jsxs(n,{container:!0,spacing:3,children:[t.jsx(n,{item:!0,xs:12,md:4,children:t.jsx(F,{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",children:k?t.jsx("img",{src:k,alt:"Ảnh đại diện",style:{width:"250px",height:"250px",objectFit:"cover",cursor:"pointer",borderRadius:"50%",boxShadow:"0px 4px 15px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease"},onClick:E}):t.jsx("img",{src:"../src/assets/images/images.jpg",alt:"Ảnh đại diện",style:{width:"250px",height:"250px",objectFit:"cover",cursor:"pointer",borderRadius:"50%",boxShadow:"0px 4px 15px rgba(0, 0, 0, 0.2)",transition:"all 0.3s ease"},onClick:E})})}),t.jsx(n,{item:!0,xs:12,md:8,children:t.jsxs(n,{container:!0,spacing:3,children:[t.jsx(n,{item:!0,xs:12,md:6,children:t.jsx(o,{name:"ten",control:i,render:({field:r})=>{var e;return t.jsx(m,{fullWidth:!0,label:"Họ và tên",variant:"outlined",InputLabelProps:{shrink:!0},...r,error:!!s.ten,helperText:(e=s.ten)==null?void 0:e.message,sx:{mb:2}})}})}),t.jsx(n,{item:!0,xs:12,md:6,children:t.jsx(o,{name:"sdt",control:i,render:({field:r})=>{var e;return t.jsx(m,{fullWidth:!0,label:"Số điện thoại",variant:"outlined",InputLabelProps:{shrink:!0},...l("sdt"),error:!!s.sdt,helperText:(e=s.sdt)==null?void 0:e.message,sx:{mb:2}})}})}),t.jsx(n,{item:!0,xs:12,md:6,children:t.jsx(o,{name:"email",control:i,render:({field:r})=>{var e;return t.jsx(m,{fullWidth:!0,label:"Email",variant:"outlined",InputLabelProps:{shrink:!0},...l("email"),error:!!s.email,helperText:(e=s.email)==null?void 0:e.message,sx:{mb:2}})}})}),t.jsx(n,{item:!0,xs:12,md:6,children:t.jsx(o,{name:"ngay_sinh",control:i,render:({field:r})=>{var e;return t.jsx(m,{type:"date",fullWidth:!0,label:"Ngày sinh",variant:"outlined",InputLabelProps:{shrink:!0},...r,error:!!s.ngay_sinh,helperText:(e=s.ngay_sinh)==null?void 0:e.message,sx:{mb:2}})}})}),t.jsx(n,{item:!0,xs:12,children:t.jsxs(y,{component:"fieldset",error:!!s.gioi_tinh,children:[t.jsx(le,{component:"legend",children:"Giới tính *"}),t.jsx(o,{name:"gioi_tinh",control:i,render:({field:r})=>t.jsxs(ce,{...r,row:!0,children:[t.jsx(H,{value:"1",control:t.jsx(M,{}),label:"Nam"}),t.jsx(H,{value:"0",control:t.jsx(M,{}),label:"Nữ"})]})}),s.gioi_tinh&&t.jsx(A,{children:s.gioi_tinh.message})]})}),t.jsx(n,{item:!0,xs:12,md:4,children:t.jsxs(y,{fullWidth:!0,sx:{mb:2},children:[t.jsx(w,{children:"Tỉnh/Thành Phố *"}),t.jsx(o,{name:"idTinhThanhPho",control:i,render:({field:r})=>t.jsx(T,{...r,value:d,onChange:e=>X(e.target.value),children:O.map(e=>t.jsx(g,{value:e.ProvinceID,children:e.ProvinceName},e.ProvinceID))})})]})}),t.jsx(n,{item:!0,xs:12,md:4,children:t.jsxs(y,{fullWidth:!0,sx:{mb:2},children:[t.jsx(w,{children:"Quận/Huyện *"}),t.jsx(o,{name:"district",control:i,render:({field:r})=>t.jsxs(T,{...r,value:u,onChange:e=>z(e.target.value),children:[t.jsx(g,{value:"",children:"Chọn quận/huyện"}),G.map(e=>t.jsx(g,{value:e.DistrictID,children:e.DistrictName},e.DistrictID))]})})]})}),t.jsx(n,{item:!0,xs:12,md:4,children:t.jsxs(y,{fullWidth:!0,sx:{mb:2},children:[t.jsx(w,{children:"Phường/Xã *"}),t.jsx(o,{name:"ward",control:i,render:({field:r})=>t.jsxs(T,{...r,value:P,onChange:e=>Q(e.target.value),children:[t.jsx(g,{value:"",children:"Chọn phường/xã"}),$.map(e=>t.jsx(g,{value:e.WardCode,children:e.WardName},e.WardCode))]})})]})}),t.jsx(n,{item:!0,xs:12,children:t.jsx(o,{name:"dia_chi",control:i,render:({field:r})=>{var e;return t.jsx(m,{...r,label:"Địa chỉ Nhận Hàng",multiline:!0,rows:4,style:{marginBottom:"30px"},fullWidth:!0,InputLabelProps:{shrink:!0},error:!!s.dia_chi,helperText:(e=s.dia_chi)==null?void 0:e.message})}})}),t.jsxs(n,{item:!0,xs:12,children:[t.jsx(F,{display:"flex",justifyContent:"center",children:t.jsx(_,{type:"submit",variant:"contained",color:"primary",style:{width:"150px"},children:Y?t.jsx(fe,{size:24}):"Lưu"})}),W&&t.jsx(A,{error:!0,children:W})]})]})})]})}),t.jsx(je,{open:Z,autoHideDuration:6e3,onClose:I,anchorOrigin:{vertical:"top",horizontal:"center"},children:t.jsx(be,{onClose:I,variant:"filled",severity:ee,sx:{width:"100%"},children:V})}),t.jsxs(ye,{open:ne,onClose:()=>D(!1),children:[t.jsx(ve,{children:"Xác nhận lưu"}),t.jsx(ke,{children:t.jsx(De,{children:"Bạn có chắc chắn muốn lưu thông tin này không?"})}),t.jsxs(Se,{children:[t.jsx(_,{onClick:()=>D(!1),color:"primary",children:"Hủy"}),t.jsx(_,{onClick:()=>D(!0),color:"primary",autoFocus:!0,children:"Xác nhận"})]})]})]})}export{Ae as default};
