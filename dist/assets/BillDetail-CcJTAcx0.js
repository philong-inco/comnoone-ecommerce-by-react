import{aa as M,j as e,G as l,T as t,C as ae,ap as te,Z as g,r as i,V as G,a2 as W,N as le,ac as Z,I as re}from"./index-COCf9D-9.js";import{r as ce,u as oe,a as de,b as he}from"./billService-BKD01eM1.js";import{b as $,c as xe,g as je,a as ge}from"./billStatus-B9UV_zRI.js";import{a as U,c as Y,b as F,D as J}from"./DialogTitle-C9lArIW3.js";import{T as _,a as V,b as E,c as H,d as z}from"./TableRow-BjFi84E7.js";import{T as s}from"./TableCell-DFzCksj9.js";import{d as ue}from"./Delete-BJFNGpus.js";import{g as me,a as pe,c as fe,b as be,d as ye,e as Ce,f as Se,h as ve,i as Te}from"./index-BCGYbM3T.js";import{B as L}from"./Box-BDe6Q2wg.js";import{C as Pe}from"./Checkbox-BaIBsI-F.js";import{P as Ie}from"./Pagination-p0ct8pHs.js";import{S as De,A as Ne}from"./Snackbar-DdnTY-uA.js";import"./request-BSxo6Ply.js";import"./LastPage-DEWP3WKD.js";import"./Close-G1yeCTF0.js";function He(p){const{billHistory:b,handleLoading:j}=p,{id:f}=M(),u=()=>{j()},c=async()=>{try{(await ce(f)).status_code===201&&(alert("Quay lại thành công"),u())}catch(o){console.log(o),alert("Quay lại thất bại")}};return e.jsx("div",{children:e.jsxs(l,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",borderRadius:4},children:[e.jsx(l,{item:!0,xs:12,children:e.jsx(t,{variant:"h5",children:"Lịch sử đơn hàng"})}),e.jsx("div",{style:{display:"flex"},children:b.map(o=>e.jsx(l,{item:!0,xs:12,sm:6,md:3,sx:{display:"flex",flexDirection:"column",alignItems:"center",marginLeft:2},children:e.jsx(ae,{sx:{width:"100%",textAlign:"center"},children:e.jsxs(te,{sx:{padding:2},children:[e.jsx("img",{src:"https://via.placeholder.com/50",alt:"Hình ảnh",style:{width:"20%",height:"auto"}}),e.jsx(t,{variant:"h6",sx:{mt:1},children:$(o.trangThai)}),e.jsx(t,{variant:"body2",sx:{mt:1,fontSize:"0.875rem"},children:o.ngayTao})]})})},o.id))}),e.jsx(l,{item:!0,xs:12,sx:{display:"flex",justifyContent:"flex-start",marginTop:0},children:e.jsx(g,{variant:"contained",color:"primary",onClick:c,children:"Quay lại trước đó"})})]})})}function Be(p){return e.jsx(e.Fragment,{children:e.jsx(l,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",marginTop:1,borderRadius:4},children:"Lịch sử thanh toán ở đây"})})}function we(p){const{id:b}=M(),{billHistory:j,handleLoading:f,bill:u}=p,[c,o]=i.useState(!1),m=()=>{o(!0)},x=()=>{o(!1)},y=()=>{f()},h=[{id:"ngayTao",label:"Thời gian"},{id:"nguoiSua",label:"Người chỉnh sửa"},{id:"trangThai",label:"Trạng Thái"},{id:"ghiChuChoCuaHang",label:"Ghi chú của hàng"},{id:"ghiChuChoKhachHang",label:"Ghi chú khách hàng"}],P=async()=>{const d=await oe(b,"HUY");d.status_code==204&&(y(),alert(`Thông báo : Hủy hóa đơn ${b} thành công`)),console.log(d.status_code)};return e.jsxs(l,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",marginTop:1,borderRadius:4},children:[e.jsxs(l,{container:!0,spacing:2,children:[e.jsxs(l,{item:!0,xs:6,sx:{display:"flex",justifyContent:"flex-start"},children:[e.jsx(g,{variant:"contained",color:"error",onClick:P,disabled:u.trangThai==="HUY",sx:{marginRight:2},children:"HỦY"}),e.jsx(g,{variant:"contained",disabled:u.trangThai==="HUY",children:"XÁC NHẬN"})]}),e.jsxs(l,{item:!0,xs:6,sx:{display:"flex",justifyContent:"flex-end"},children:[e.jsx(g,{variant:"contained",sx:{marginRight:2},children:"IN HÓA ĐƠN"}),e.jsx(g,{variant:"contained",sx:{marginRight:2},children:"IN PHIẾU GIAO HÀNG"}),e.jsxs(g,{variant:"contained",color:"warning",onClick:m,children:["CHI TIẾT"," "]})]})]}),e.jsxs(U,{open:c,onClose:x,maxWidth:"md",fullWidth:!0,children:[e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(t,{variant:"h5",children:["Chi tiết lịch sử thay đổi hóa đơn : ",e.jsx("strong",{children:b})]}),e.jsx(g,{onClick:x,children:"Đóng"})]}),e.jsx(F,{children:e.jsx(_,{component:G,children:e.jsxs(V,{children:[e.jsx(E,{children:e.jsx(H,{children:h.map(d=>e.jsx(s,{children:d.label},d.id))})}),e.jsx(z,{children:j.map((d,v)=>e.jsxs(H,{children:[e.jsx(s,{children:d.ngayTao}),e.jsx(s,{children:d.nguoiSua}),e.jsx(s,{children:e.jsx(W,{label:$(d.trangThai),sx:{backgroundColor:xe(d.trangThai),color:"#fff"}})}),e.jsx(s,{children:d.ghiChuChoCuaHang}),e.jsx(s,{children:d.ghiChuChoKhachHang})]},v))})]})})})]})]})}function ke({onProductSelected:p,handleLoading:b,handleLoadingTimeLine:j,selectedSerialIds:f=[]}){const{id:u}=M(),[c,o]=i.useState([]),[m,x]=i.useState({open:!1,message:"",severity:"success"}),[y,h]=i.useState(!1),[P,d]=i.useState(null),[v,I]=i.useState(f),[D,A]=i.useState([]),[k,B]=i.useState(null),[w,a]=i.useState(1),[C,r]=i.useState(5),[S,T]=i.useState(0),R=async()=>{const n=await pe();n.code===200&&o(n.data)},X=async(n,N,K)=>{const O=await be(n,N-1,K);O.status_code===200&&(A(O.data.result),T(O.data.meta.total),a(O.data.meta.page+1))},ee=n=>{B(n),X(n,w,5),h(!0)},q=()=>{h(!1),I([]),a(1),B(null),d(null)},se=async()=>{(await fe({billCode:u,listSerialNumberId:v})).status_code===201&&(h(!1),I([]),a(1),B(null),d(null),alert("Oke"))},ne=n=>{I(N=>N.includes(n)?N.filter(K=>K!==n):[...N,n])};i.useEffect(()=>{R()},[]);const ie=n=>{I(v),a(n),X(k,n,C)};return e.jsxs(G,{sx:{padding:2},children:[e.jsx(l,{container:!0,spacing:2,marginBottom:2,children:e.jsx(l,{item:!0,xs:12,children:e.jsx(t,{variant:"h6",children:"Tìm kiếm"})})}),e.jsx(_,{sx:{maxHeight:"70vh"},children:e.jsxs(V,{stickyHeader:!0,children:[e.jsx(E,{children:e.jsxs(H,{children:[e.jsx(s,{children:"Ảnh"}),e.jsx(s,{children:"Tên"}),e.jsx(s,{children:"Mã"}),e.jsx(s,{children:"Bàn phím"}),e.jsx(s,{children:"CPU"}),e.jsx(s,{children:"Màn hình"}),e.jsx(s,{children:"Màu sắc"}),e.jsx(s,{children:"RAM"}),e.jsx(s,{children:"VGA"}),e.jsx(s,{children:"Webcam"}),e.jsx(s,{children:"Ổ cứng"}),e.jsx(s,{children:"Giá"}),e.jsx(s,{children:"Thao tác"})]})}),e.jsx(z,{children:c.map(n=>e.jsxs(H,{children:[e.jsx(s,{children:e.jsx("img",{src:"https://via.placeholder.com/50",alt:"Product",width:"50"})}),e.jsx(s,{children:n.sanPham}),e.jsx(s,{children:n.ma}),e.jsx(s,{children:n.banPhim}),e.jsx(s,{children:n.cpu}),e.jsx(s,{children:n.manHinh}),e.jsx(s,{children:n.mauSac}),e.jsx(s,{children:n.ram}),e.jsx(s,{children:n.vga}),e.jsx(s,{children:n.webcam}),e.jsx(s,{children:n.ocung}),e.jsx(s,{children:e.jsxs(t,{color:"error",children:[parseInt(n.giaBan).toLocaleString()," VNĐ"]})}),e.jsx(s,{children:e.jsx(g,{variant:"contained",color:"primary",onClick:()=>ee(n.id),children:"Chọn"})})]},n.id))})]})}),e.jsxs(U,{open:y,onClose:q,PaperProps:{style:{width:"700px"}},children:[e.jsx(Y,{children:e.jsxs(L,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsx("span",{style:{fontSize:"1.2rem",fontWeight:"bold"},children:"Danh sách serial"}),e.jsx(le,{variant:"outlined",size:"small",label:"Tìm kiếm",style:{marginRight:"16px"}})]})}),e.jsxs(F,{children:[e.jsx(_,{component:G,children:e.jsxs(V,{children:[e.jsx(E,{children:e.jsxs(H,{children:[e.jsx(s,{children:"Chọn"}),e.jsx(s,{children:"Mã"}),e.jsx(s,{children:"Trạng thái"})]})}),e.jsx(z,{children:D.map(n=>e.jsxs(H,{children:[e.jsx(Pe,{checked:v.includes(n.id),onChange:()=>ne(n.id),disabled:n.trangThai===1&&!v.includes(n.id)}),e.jsx(s,{children:n.ma}),e.jsx(s,{children:e.jsx(W,{label:n.trangThai==0?"Còn hàng":n.trangThai==1?"Đã bán":"Hủy",style:{backgroundColor:me(n.trangThai),color:"#fff"},size:"small"})})]},n.id))})]})}),e.jsx(Ie,{sx:{marginTop:"10px",textAlign:"center"},count:Math.ceil(S/C),page:w,onChange:(n,N)=>ie(N)})]}),e.jsxs(J,{children:[e.jsx(g,{onClick:q,children:"Hủy"}),e.jsx(g,{onClick:()=>{se()},variant:"contained",color:"primary",children:"Xác nhận"})]})]}),e.jsx(De,{open:m.open,autoHideDuration:3e3,onClose:()=>x({...m,open:!1}),children:e.jsx(Ne,{onClose:()=>x({...m,open:!1}),severity:m.severity,children:m.message})})]})}function Le(p){const{handleLoading:b,bill:j,fetchBill:f}=p,{id:u}=M(),[c,o]=i.useState(!1),[m,x]=i.useState(!1),[y,h]=i.useState([]),[P,d]=i.useState([]),[v,I]=i.useState({open:!1,message:"",severity:"success"}),D=async()=>{const r=await ye(u);if(r.status_code===200){d(r.data);const S=r.data.flatMap(T=>T.serialNumbers.map(R=>R.serialNumberId));h(S)}},A=async(r,S)=>{const T=await Ce(r,S);T.status_code===200&&(I({open:!0,message:T.message,severity:"success"}),D(),f(),alert("Oke"))};i.useEffect(()=>{D()},[c]);const k=()=>{x(!1)},B=()=>{o(!c)},w=()=>{x(!m)},a=()=>{x(!1)},C=r=>{console.log("Value : ",r);const S=r.serialNumbers.map(R=>R.serialNumberId);console.log("data : ",{billCode:u,serialNumberIds:S}),A(u,S)};return e.jsxs(e.Fragment,{children:[e.jsx(l,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",marginTop:1,borderRadius:4},children:e.jsxs(G,{sx:{padding:2,marginTop:2,borderRadius:2,width:"100%"},children:[e.jsx(l,{container:!0,spacing:2,children:e.jsxs(l,{item:!0,xs:12,container:!0,justifyContent:"space-between",alignItems:"center",children:[e.jsx(t,{variant:"h5",children:"Danh sách sản phẩm"}),e.jsx(g,{variant:"contained",color:"warning",onClick:w,disabled:j.trangThai=="HUY",children:"Thêm sản phẩm"})]})}),e.jsxs(U,{open:m,onClose:k,maxWidth:"xl",fullWidth:!0,children:[e.jsxs(Y,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(t,{variant:"h5",children:"Danh sách sản phẩm"}),e.jsx(g,{onClick:k,children:"Đóng"})]}),e.jsx(F,{children:e.jsx(ke,{handleLoading:B,handleLoadingTimeLine:b,onProductSelected:a,selectedSerialIds:y})})]}),e.jsx(Z,{sx:{marginY:2}}),e.jsx(_,{component:G,sx:{width:"100%"},children:e.jsxs(V,{"aria-label":"simple table",children:[e.jsx(E,{children:e.jsxs(H,{children:[e.jsx(s,{children:"Ảnh"}),e.jsx(s,{children:"Mã SP"}),e.jsx(s,{children:"Tên sản phẩm"}),e.jsx(s,{children:"Giá"}),e.jsx(s,{children:"Số lượng"}),e.jsx(s,{children:"Thành tiền"}),e.jsx(s,{children:"Serial"}),e.jsx(s,{children:"Hành động"})]})}),e.jsx(z,{children:P.map(r=>e.jsxs(H,{children:[e.jsx(s,{children:e.jsx("img",{src:"https://via.placeholder.com/50",alt:"Product",width:"50"})}),e.jsx(s,{children:r.productDetailCode}),e.jsx(s,{children:r.productName}),e.jsx(s,{children:e.jsxs("strong",{children:[parseInt(r.price).toLocaleString()," VNĐ"]})}),e.jsx(s,{children:e.jsxs("strong",{children:[r.quantity," "]})}),e.jsx(s,{children:e.jsxs("strong",{children:[parseInt(r.quantity*r.price).toLocaleString()," VNĐ"]})}),e.jsx(s,{children:e.jsx("strong",{children:r.serialNumbers.map((S,T)=>e.jsxs("span",{children:[S.serialNumberCode,T<r.serialNumbers.length-1&&", "]},S.serialNumberId))})}),e.jsx(s,{children:e.jsx(re,{color:"error",onClick:()=>C(r),children:e.jsx(ue,{})})})]},r.id))})]})})]})}),e.jsxs(l,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",marginTop:1,borderRadius:4},children:[e.jsx(l,{item:!0,xs:9,sx:{display:"flex",justifyContent:"flex-start"},children:e.jsxs(t,{children:["Phiếu giảm giá : ",e.jsx("strong",{children:j.maPGG})]})}),e.jsxs(l,{item:!0,xs:3,sx:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[e.jsxs(t,{children:[e.jsx("strong",{children:" Tổng tiền hàng : "})," ",e.jsxs("strong",{style:{color:"red",marginLeft:"8px"},children:[" ",parseInt(j.tongTienBanDau).toLocaleString()," VNĐ"]})]}),e.jsxs(t,{children:["Giá trị giảm :",e.jsxs("strong",{children:[j.giaTriPhieuGiamGia," ",j.loaiPGG==1?"%":"VNĐ"]})]}),e.jsx(t,{children:"Phí vận chuyển :"}),e.jsx(Z,{sx:{width:"100%",marginY:1}}),e.jsxs(t,{children:[e.jsx("strong",{children:"Tổng tiền :"}),e.jsxs("strong",{style:{color:"red",marginLeft:"8px"},children:[" ",parseInt(j.tongTienPhaiTra).toLocaleString()," VNĐ"]})]})]})]})]})}const Ae=()=>{const[p,b]=i.useState([]),[j,f]=i.useState([]),[u,c]=i.useState([]),[o,m]=i.useState(""),[x,y]=i.useState(""),[h,P]=i.useState(""),[d,v]=i.useState(!1),I=()=>v(!0),D=()=>v(!1);i.useEffect(()=>{(async()=>{const C=await Se();b(C.data)})()},[]);const A=async a=>{const C=a.target.value;m(C);const r=await ve(C);f(r.data),y(""),P(""),c([])},k=async a=>{const C=a.target.value;y(C);const r=await Te(C);c(r.data),P("")},B=a=>{P(a.target.value)},w=a=>{a.preventDefault(),console.log("Selected Address:",{province:o,district:x,ward:h}),D()};return e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"contained",color:"primary",onClick:I,children:"Cập nhập địa chỉ"}),e.jsxs(U,{open:d,onClose:D,maxWidth:"md",fullWidth:!0,children:[e.jsx(Y,{children:"Chọn Địa Chỉ"}),e.jsx(F,{children:e.jsxs("form",{onSubmit:w,children:[e.jsx("div",{style:{marginBottom:"16px",width:"100%"},children:e.jsxs("select",{id:"province",value:o,onChange:A,style:Q,children:[e.jsx("option",{value:"",children:"Chọn Tỉnh/Thành Phố"}),p.map(a=>e.jsx("option",{value:a.ProvinceID,children:a.ProvinceName},a.ProvinceID))]})}),e.jsx("div",{style:{marginBottom:"16px",width:"100%"},children:e.jsxs("select",{id:"district",value:x,onChange:k,disabled:!o,style:Q,children:[e.jsx("option",{value:"",children:"Chọn Quận/Huyện"}),j.map(a=>e.jsx("option",{value:a.DistrictID,children:a.DistrictName},a.DistrictID))]})}),e.jsx("div",{style:{marginBottom:"16px",width:"100%"},children:e.jsxs("select",{id:"ward",value:h,onChange:B,disabled:!x,style:Q,children:[e.jsx("option",{value:"",children:"Chọn Phường/Xã"}),u.map(a=>e.jsx("option",{value:a.WardCode,children:a.WardName},a.WardCode))]})})]})}),e.jsxs(J,{children:[e.jsx(g,{onClick:D,color:"secondary",children:"Hủy"}),e.jsx(g,{onClick:w,color:"primary",children:"Xác Nhận"})]})]})]})},Q={width:"100%",padding:"8px",border:"1px solid rgba(0, 0, 0, 0.23)",borderRadius:"4px",fontSize:"16px",lineHeight:"1.5",transition:"border-color 0.3s, box-shadow 0.3s",appearance:"none",backgroundColor:"white","&:hover":{borderColor:"rgba(0, 0, 0, 0.87)"},"&:focus":{borderColor:"#3f51b5",boxShadow:"0 0 0 2px rgba(63, 81, 181, 0.2)"},"&:disabled":{backgroundColor:"#f5f5f5",cursor:"not-allowed"}};function qe(){const{id:p}=M(),[b,j]=i.useState(!1),[f,u]=i.useState([]),[c,o]=i.useState({}),m=async()=>{const h=await de(p);h.status_code===200&&u(h.data)},x=async()=>{const h=await he(p);h.status_code===200&&o(h.data)};i.useEffect(()=>{m(),x()},[p,b]);const y=()=>{j(h=>!h)};return e.jsxs(e.Fragment,{children:[e.jsxs(t,{variant:"h4",sx:{marginBottom:3},children:["Quản lý đơn hàng :"," ",e.jsx(t,{component:"span",sx:{color:"gray"},children:c.ma})]}),e.jsx(He,{billHistory:f,handleLoading:y}),e.jsx(we,{billHistory:f,bill:c,handleLoading:y}),e.jsxs(l,{container:!0,spacing:2,padding:2,sx:{backgroundColor:"white",borderRadius:4,mt:1},children:[e.jsx(l,{item:!0,xs:10,children:e.jsx(t,{variant:"h5",children:"Thông tin đơn hàng"})}),e.jsx(l,{item:!0,xs:2,container:!0,justifyContent:"flex-end",children:e.jsx(Ae,{})}),e.jsxs(l,{item:!0,xs:4,children:[e.jsx(t,{variant:"body1",children:"Mã:"}),e.jsx(t,{variant:"body1",sx:{fontWeight:"bold",ml:1},children:c.ma})]}),e.jsx(l,{item:!0,xs:4,children:e.jsxs(L,{display:"flex",alignItems:"center",children:[e.jsx(t,{variant:"body1",children:"Tên khách hàng:"}),c.tenKhachHang===null?e.jsx(W,{label:"Khách lẻ",color:"info",sx:{ml:1}}):e.jsx(t,{variant:"body1",sx:{ml:1},children:c.tenKhachHang})]})}),e.jsx(l,{item:!0,xs:4,children:e.jsxs(L,{display:"flex",alignItems:"center",children:[e.jsx(t,{variant:"body1",children:"Trạng thái:"}),e.jsx(W,{label:je(c.trangThai),sx:{ml:1,backgroundColor:ge(c.trangThai),color:"#fff"}})]})}),e.jsx(l,{item:!0,xs:4,children:e.jsxs(L,{display:"flex",alignItems:"center",children:[e.jsx(t,{variant:"body1",children:"SĐT người nhận:"}),e.jsx(t,{variant:"body1",sx:{ml:1},children:c.sdt})]})}),e.jsx(l,{item:!0,xs:4,children:e.jsxs(L,{display:"flex",alignItems:"center",children:[e.jsx(t,{variant:"body1",children:"Loại hóa đơn:"}),e.jsx(W,{label:c.loaiHoaDon=="0"?"Tại quầy":"Online",color:c.loaiHoaDon=="0"?"primary":"success",sx:{ml:1}})]})}),e.jsx(l,{item:!0,xs:4,children:e.jsxs(L,{display:"flex",alignItems:"center",children:[e.jsx(t,{variant:"body1",children:"Tên người nhận:"}),e.jsx(t,{variant:"body1",sx:{ml:1},children:" ???"})]})})]}),e.jsx(Be,{billHistory:f}),e.jsx(Le,{handleLoading:y,bill:c,fetchBill:x})]})}export{qe as default};
